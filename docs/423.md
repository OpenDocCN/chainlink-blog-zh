# 如何使用 DappTools

> 原文:[https://blog.chain.link/how-to-use-dapptools/](https://blog.chain.link/how-to-use-dapptools/)

说到写智能合约，开发者只需要知道一种语言，比如 [Solidity](https://docs.soliditylang.org/en/v0.8.11/) ， [Vyper](https://vyper.readthedocs.io/en/stable/) ，或者[Rust](https://www.rust-lang.org/learn)。然而，选择一个框架并学习围绕该框架的所有语言可能会很棘手。  

学习像[DappTools](https://dapp.tools/)这样的极简命令行框架可以消除这些问题，让 Web3 开发者的生活变得更加轻松。

在本 daptools 教程中，您将学习如何通过 daptools 框架创建、测试和部署您的智能合约。

查看本教程的视频:

<iframe title="How to Use DappTools | Chainlink Engineering Tutorials" width="1380" height="776" src="https://www.youtube.com/embed/csTWByu481I?feature=oembed" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></div> <p> </p> <h2><span style="font-weight: 400;">什么是 DappTools？</span></h2> <p>DappTools 是一个类似于 Hardhat 和 Brownie 的框架，帮助智能联系人开发人员测试、部署和维护他们的代码。如果部署一个契约，那么编译后的字节码存储在哪里？你怎么知道它去了哪里？重新部署新代码有多容易？所有这些都是通过使用智能契约开发框架解决的问题。</p> <p>DappTools 最初是用 Haskell 编写的。然而最近，Paradigm 团队采用了 DappTools，并在 Rust 中重写了它，将他们的新创作称为 <a href="https://www.paradigm.xyz/2021/12/introducing-the-foundry-ethereum-development-toolbox/"> <span style="font-weight: 400;">铸造</span> </a> <span style="font-weight: 400;">。两者的工作方式相似，都是以命令行为中心的，快速的，并且经常涉及到编写大量模糊的可靠性测试。</span></p> <p>DappTools 是许多领先协议的流行选择。</p> <h2>为什么要使用 DappTools？</h2> <p>如果你是一个热爱 Linux、bash shells 和快速、以命令行为中心的编码的开发人员，那么这绝对是一个你应该尝试的智能契约框架。此外，如果您不熟悉 JavaScript 或 Python，这也非常适合您！</p> <h2>我们在学习什么？</h2> <p>在本教程中，我们将学习如何:</p> <ol> <li style="font-weight: 400;" aria-level="1"><span style="font-weight: 400;">使用 DappTools </span></li> <li style="font-weight: 400;" aria-level="1"><span style="font-weight: 400;">部署 Chainlink-powered </span> <a href="https://blog.chain.link/hybrid-smart-contracts-explained/"> <span style="font-weight: 400;">混合智能合约</span> </a> <span style="font-weight: 400;">使用</span><a href="https://github.com/smartcontractkit/dapptools-starter-kit"><span style="font-weight: 400;">daptools-starter-kit</span></a></li> </ol> <p><span style="font-weight: 400;">下面是几个在这个初学者工具包中使用 Chainlink 服务的例子:</span></p> <ul> <li style="font-weight: 400;" aria-level="1"><a href="https://docs.chain.link/docs/get-the-latest-price/"> <span style="font-weight: 400;">链环价格提要</span> </a></li> <li style="font-weight: 400;" aria-level="1"><a href="https://docs.chain.link/docs/chainlink-vrf/"> <span style="font-weight: 400;">链型 VRF </span> </a>链型 VRF</li> <li style="font-weight: 400;" aria-level="1"><a href="https://docs.chain.link/docs/chainlink-automation/introduction/"><span style="font-weight: 400;"/></a></li> </ul> <h2><span style="font-weight: 400;">安装</span></h2> <h3><span style="font-weight: 400;">要求</span></h3> <p>首先，我们需要安装一些东西。</p> <ul> <li><a href="https://git-scm.com/book/en/v2/Getting-Started-Installing-Git"> <span style="font-weight: 400;">去</span> </a>去</li> <li><a style="font-size: 16px; background-color: #ffffff;" href="https://github.com/dapphub/dapptools#installation"> <span style="font-weight: 400;"> DappTools </span> </a></li> </ul> <p><span style="font-weight: 400;">您可能已经安装了它，但如果没有，您将需要<code>make</code>。按照</span> <a href="https://askubuntu.com/questions/161104/how-do-i-install-make"> <span style="font-weight: 400;">这些步骤</span> </a> <span style="font-weight: 400;">检查你是否安装了。</span></p> <h3><span style="font-weight: 400;">入门</span></h3> <p>一旦我们安装了这些工具，我们就可以克隆 starter kit repo 并开始工作。</p> <pre><span style="font-weight: 400;">sh</span>&#13; <span style="font-weight: 400;">git clone https://github.com/smartcontractkit/dapptools-starter-kit</span>&#13; <span style="font-weight: 400;">cd dapptools-starter-kit</span>&#13; <span style="font-weight: 400;">make # This installs the project's dependencies.</span>&#13; <span style="font-weight: 400;">make test</span></pre> <p><span style="font-weight: 400;">现在你有了文件，让我们来看看每件事都做了什么:</span></p> <ul> <li style="font-weight: 400;" aria-level="1"><span style="font-weight: 400;"> <code>Makefile</code>:放置脚本的地方。DappTools 是基于命令行的，我们的 makefile 帮助我们用几个字符运行大型命令。</span></li> <li style="font-weight: 400;" aria-level="1"><span style="font-weight: 400;"> <code>lib</code>:这个文件夹是用于外部依赖的，比如 OpenZeppelin 或者 ds-test。</span></li> <li style="font-weight: 400;" aria-level="1"><span style="font-weight: 400;"> <code>out</code>:你编译的代码去哪了。类似于 Brownie 中的构建文件夹或 Hardhat 中的工件文件夹。</span></li> <li style="font-weight: 400;" aria-level="1"><span style="font-weight: 400;"> <code>src</code>:这就是你的智能合约所在。类似于 Brownie 和 Hardhat 中的合同文件夹。</span></li> </ul> <h3><span style="font-weight: 400;">测试</span></h3> <p><span style="font-weight: 400;">让我们做些测试吧！为了测试我们可以运行</span> <span style="font-weight: 400;"> <code>make test</code> </span> <span style="font-weight: 400;">或者</span> <span style="font-weight: 400;"> <code>dapp test</code>。</span></p> <p>【DappTools 中的所有命令都与这个 repo 一起工作，包括<code>dapp build</code>、<code>ethsign</code>和<code>dapp test</code>。</p> <h3><span style="font-weight: 400;">导入外部依赖关系</span></h3> <p><span style="font-weight: 400;">假设我们想要使用</span> <a href="https://docs.openzeppelin.com/contracts/2.x/api/token/erc721"> <span style="font-weight: 400;"> OpenZeppelin 标准</span> </a> <span style="font-weight: 400;">创建一个 NFT。要安装外部契约或包，我们可以使用<code>dapp install</code>命令。我们需要命名 GitHub 回购组织和要安装的回购名称。</span></p> <p>首先，我们需要提交到目前为止所做的更改。DappTools 将外部包作为 git 子模块引入，所以我们需要首先提交。</p> <p><span style="font-weight: 400;">运行:</span></p> <pre><span style="font-weight: 400;">git add .</span>&#13; <span style="font-weight: 400;">git commit -m ‘initial commit’</span></pre> <p>然后，我们可以安装我们的外部软件包。例如，对于 OpenZeppelin，我们将使用:</p> <pre><span style="font-weight: 400;">dapp install OpenZeppelin/openzeppelin-contracts</span></pre> <p>现在你应该会在你的 lib 文件夹中看到一个名为 openzeppelin-contracts 的新文件夹，因为它是从 GitHub 下载的。这个回购已经从 OpenZeppelin 合同开始，所以有一些重复，但我们仍然要看看它是如何工作的。</p> <h2><span style="font-weight: 400;">展开</span></h2> <p><span style="font-weight: 400;">要进行部署，您首先需要设置您的<code>ethsign</code>和<code>.env</code>文件。</span></p> <h3><span style="font-weight: 400;">设置您的帐户/ethsign </span></h3> <p><span style="font-weight: 400;">要将您的私钥放入 DappTools，您可以使用 keystore 或<code>ethsign</code>。<code>ethsign</code>随<code>dapptools</code>的安装一起提供。对于<code>ethsign</code>，运行以下:</span></p> <pre><span style="font-weight: 400;">bash</span>&#13; <span style="font-weight: 400;">ethsign import </span></pre> <p><span style="font-weight: 400;">现在会提示您输入私钥和密码。可以从类似</span> <a href="https://metamask.io/"> <span style="font-weight: 400;"> MetaMask </span> </a> <span style="font-weight: 400;">的钱包中获得私钥。一旦成功，将私钥的地址添加到您的<code>.env</code>文件中的一个<code>ETH_FROM</code>变量下。参见<code>.env.example</code>文件中的例子。</span></p> <p><span style="font-weight: 400;">请参见<code>Makefile</code>了解更多关于这种工作方式的背景信息。</span></p> <p>如果你要部署到一个测试网，确保你的钱包里有测试网 ETH 和 LINK。你可以从 <a href="https://faucets.chain.link/"> <span style="font-weight: 400;">链接龙头</span> </a> <span style="font-weight: 400;">获得 testnet 链接。</span></p> <h3><span style="font-weight: 400;">建立你的<code>.env</code>档案</span></h3> <p><span style="font-weight: 400;">你可以在<code>.env.example</code>中看到你的<code>.env</code>应该是什么样子的一个例子(部署到一个真实的网络)。</span></p> <ol> <li><span style="font-weight: 400;"> <code>ALCHEMY_API_KEY</code>:获取一个</span> <a href="https://www.alchemy.com/"> <span style="font-weight: 400;">炼金术</span> </a> <span style="font-weight: 400;">账号即可找到。</span></li> <li><span style="font-weight: 400;"> <code>ETH_FROM</code>:你要发送交易的钱包地址。您必须将您想要使用的地址的私钥加载到您的<code>ethsign</code>中，请参见上文。</span></li> <li><span style="font-weight: 400;"> <code>ETHERSCAN_API_KEY</code>:用于在 Etherscan 上验证合同(可选)。</span></li> <li><span style="font-weight: 400;"> <code>ETH_RPC_URL</code>:使用<code>make deploy</code>时有默认部署网络(可选)。</span></li> </ol> <h2><span style="font-weight: 400;">测试网和维护网部署</span></h2> <p><span style="font-weight: 400;">在你的<code>.env</code>文件中设置你的<code>ETH_RPC_URL</code>或<code>ALCHEMY_API_KEY</code>，然后运行以下命令之一:</span></p> <p><span style="font-weight: 400;">柜台(自动化兼容合同):</span></p> <pre><span style="font-weight: 400;">bash</span>&#13; <span style="font-weight: 400;">make deploy CONTRACT=Counter</span></pre> <p><span style="font-weight: 400;">价格馈送:</span></p> <pre><span style="font-weight: 400;">bash</span>&#13; <span style="font-weight: 400;">make deploy CONTRACT=PriceFeedConsumer</span></pre> <p><span style="font-weight: 400;">链家 VRF 消费者:</span></p> <pre><span style="font-weight: 400;">bash</span>&#13; <span style="font-weight: 400;">make deploy CONTRACT=VRFConsumer</span></pre> <p><span style="font-weight: 400;">您可以在<code>scripts</code>文件夹中各自的<code>deploy</code>文件中更改它们的部署参数。所有的构造函数参数都创建在<code>./src/helper-config.sh</code>文件夹中。在这里，您可以跨网络分配不同的构造函数参数。</span></p> <h4><span style="font-weight: 400;">本地测试网</span></h4> <p><span style="font-weight: 400;"> #在一个端子上</span></p> <p><span style="font-weight: 400;"> dapp 测试网</span></p> <p><span style="font-weight: 400;">把你的<code>ETH_RPC_URL</code>改成<code>http://127.0.0.1:8545</code> </span></p> <p>然后运行您的部署脚本。</p> <h4><span style="font-weight: 400;">在以太扫描上验证</span></h4> <p><span style="font-weight: 400;">部署合同后，您可以使用</span>在 Etherscan 上验证合同</p> <pre><span style="font-weight: 400;">ETHERSCAN_API_KEY=&lt;api-key&gt; dapp verify-contract &lt;contract_directory&gt;/&lt;contract&gt;:&lt;contract_name&gt; &lt;contract_address&gt;</span></pre> <p><span style="font-weight: 400;">例如:</span></p> <pre><span style="font-weight: 400;">ETHERSCAN_API_KEY=123456765 dapp verify-contract ./src/Counter.sol:Counter 0x23456534212536435424</span></pre> <p><span style="font-weight: 400;">查看</span> <a href="https://github.com/dapphub/dapptools/tree/master/src/dapp#dapp-verify-contract"> <span style="font-weight: 400;"> dapp 文档</span> </a> <span style="font-weight: 400;">看看如何使用 DappTools 验证合同。</span></p> <h2><span style="font-weight: 400;">与您的合同互动</span></h2> <p><span style="font-weight: 400;">为了与我们的合同进行交互，我们使用<code>seth</code>命令。假设我们已经将我们的<code>PriceFeedConsumer.sol</code>部署到了 Kovan，现在我们想要调用<code>getLatestPrice</code>函数。我们如何做到这一点？</span></p> <pre><span style="font-weight: 400;">ETH_RPC_URL=&lt;YOUR_RPC_URL&gt; seth call &lt;YOUR_CONTRACT_ADDRESS&gt; "getLatestPrice()"</span></pre> <p><span style="font-weight: 400;">例如:</span></p> <pre><span style="font-weight: 400;">ETH_RPC_URL=https://alchemy.io/adsfasdf seth call 0xd39F749195Ab1B4772fBB496EDAF56729ee36E55 "getLatestPrice()"</span></pre> <p><span style="font-weight: 400;">这将给我们一个类似于<code>0x0000000000000000000000000000000000000000000000000000004c17b125c0</code>的输出，它是<code>326815000000</code> </span>的十六进制数</p> <p><span style="font-weight: 400;">这是打电话交易(不是花煤气)。要改变区块链的状态，我们可以使用<code>seth send</code>。假设我们部署了一个<code>VRFConsumer</code>合同，我们想调用<code>getRandomNumber</code> : </span></p> <p><span style="font-weight: 400;">首先，我们需要将我们的合同发送到 Kovan 链上的某个环节:</span></p> <pre><span style="font-weight: 400;">ETH_RPC_URL=&lt;YOUR_RPC_URL&gt; ETH_FROM=&lt;YOUR_FROM_ADDRESS&gt; seth send &lt;LINK_TOKEN_ADDRESS&gt; "transfer(address,uint256)" &lt;VRF_CONSUMER_ADDRESS&gt; 1000000000000000000</span></pre> <p><span style="font-weight: 400;">喜欢:</span></p> <pre><span style="font-weight: 400;">ETH_RPC_URL=https://alchemy.io/adfasdf ETH_FROM=0x12345 seth send 0xa36085F69e2889c224210F603D836748e7dC0088 "transfer(address,uint256)" 0xa74576956E24a8Fa768723Bd5284BcBE1Ea03adA 100000000000000000</span></pre> <p><span style="font-weight: 400;">其中<code>100000000000000000</code> = 1 环节</span></p> <p><span style="font-weight: 400;">然后，我们可以调用<code>getRandomNumber</code>函数:</span></p> <pre><span style="font-weight: 400;">ETH_RPC_URL=&lt;YOUR_RPC_URL&gt; ETH_FROM=&lt;YOUR_FROM_ADDRESS&gt; seth send &lt;VRF_CONSUMER_ADDRESS&gt;  "getRandomNumber()"</span></pre> <p><span style="font-weight: 400;">稍微延迟后，读取结果:</span></p> <pre><span style="font-weight: 400;">ETH_RPC_URL=&lt;YOUR_RPC_URL&gt; seth call &lt;VRF_CONSUMER_ADDRESS&gt; "randomResult()"</span></pre> <p><span style="font-weight: 400;">如您所见，将这些脚本保存在我们的<code>scripts</code>文件夹中会很棒。如果你想投稿，请制作一个 PR！</span></p> <h2><span style="font-weight: 400;">资源</span></h2> <p><span style="font-weight: 400;">本教程的一些有用资源:</span></p> <ul> <li style="font-weight: 400;" aria-level="1"><a href="https://dapp.tools"> <span style="font-weight: 400;"> DappTools </span> </a><ul> <li style="font-weight: 400;" aria-level="2"><a href="https://github.com/dapphub/dapptools/blob/master/src/hevm/README.md"> <span style="font-weight: 400;"> Hevm 文档</span> </a></li> <li style="font-weight: 400;" aria-level="2"><a href="https://github.com/dapphub/dapptools/tree/master/src/dapp/README.md"> <span style="font-weight: 400;"> Dapp 文档</span> </a></li> <li style="font-weight: 400;" aria-level="2"><a href="https://github.com/dapphub/dapptools/tree/master/src/seth/README.md"> <span style="font-weight: 400;">塞斯文件</span> </a></li> </ul> </li> <li style="font-weight: 400;" aria-level="1"><a href="https://docs.chain.link"> <span style="font-weight: 400;">链环</span> </a></li> <li style="font-weight: 400;" aria-level="1"><a href="https://github.com/rajivpo/awesome-dapptools"> <span style="font-weight: 400;">牛逼-dapptools </span> </a></li> </ul> <h2><span style="font-weight: 400;">总结</span></h2> <p>DappTools 是一个非常强大的应用程序，可以帮助您构建一个改变游戏规则的 dApp。我们建议检查一下，试一试，看看通过利用 Chainlink 分散式服务可以构建什么。</p> <p><span style="font-weight: 400;">访问</span><a href="https://chain.link"><span style="font-weight: 400;">chain . link</span></a><span style="font-weight: 400;">或阅读</span><a href="https://docs.chain.link"><span style="font-weight: 400;">docs . chain . link</span></a><span style="font-weight: 400;">上的文档，了解更多关于 Chainlink 的信息。要讨论整合，<a href="https://chainlinkcommunity.typeform.com/to/OYQO67EF">联系专家</a>。</span></p> <div class="widget_tag_cloud tag-list"/> </body> </html></iframe>