# 如何建立一个加密游戏

> 原文:[https://blog.chain.link/how-to-build-a-crypto-game/](https://blog.chain.link/how-to-build-a-crypto-game/)

这个技术教程将教你如何在以太坊 Goerli 测试网络上构建和部署一个全栈 dApp 加密游戏。您将构建的游戏存储了区块链上的测验问题及其答案。答案通过 `keccak256` 散列，因此您可以验证答案而无需泄露。 `Keccak256` 是单向加密哈希函数，不能反向解码。这意味着检查答案是否正确的方法将是提供一个猜测并散列它。如果两个哈希值匹配，您的答案是正确的。

本教程将使用:

*   [坚实度](https://docs.soliditylang.org/)
*   [戈利](https://goerli.net/)
*   [铸造厂](https://github.com/foundry-rs/foundry)
*   [](https://kit.svelte.dev/)

你可以在下面查看涵盖整个过程的视频教程，在这里访问包含游戏[的 GitHub repo。](https://github.com/smartcontractkit/smart-contract-examples/tree/main/quiz-game)

<iframe title="How To Build a Blockchain Gaming DApp | Chainlink Engineering Tutorials" width="1380" height="776" src="https://www.youtube.com/embed/niqxn57vx9k?feature=oembed" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></div> <h2><span style="font-weight: 400;">准备就绪</span></h2> <h3><span style="font-weight: 400;">获得戈利以太</span></h3> <p><span style="font-weight: 400;">如果你以前没有用过 Goerli，去</span> <a href="https://faucets.chain.link/"> <span style="font-weight: 400;"> Chainlink Labs 水龙头</span> </a> <span style="font-weight: 400;">获取一些 testnet ETH。</span></p> <h3><span style="font-weight: 400;">安装铸造车间</span></h3> <p>在本教程中，您将使用 Foundry 来构建、测试和部署您的 Solidity。你可以在 <a href="https://github.com/foundry-rs/foundry#installation"> <span style="font-weight: 400;"> Foundry GitHub 上找到说明。</span> </a></p> <h3><span style="font-weight: 400;">初始化项目</span></h3> <p><span style="font-weight: 400;">在您的终端中输入以下内容:</span></p> <pre><span style="font-weight: 400;">❯ Development mkdir QuizGame</span>&#13; <span style="font-weight: 400;">❯ Development </span><span style="font-weight: 400;">cd</span><span style="font-weight: 400;"> QuizGame</span>&#13; <span style="font-weight: 400;">❯ QuizGame forge init foundry</span>&#13; <span style="font-weight: 400;">Initializing /Users/rg/Development/QuizGame/foundry...</span>&#13; <span style="font-weight: 400;">Installing ds-test </span><span style="font-weight: 400;">in</span> <span style="font-weight: 400;">"/Users/rg/Development/QuizGame/foundry/lib/ds-test"</span><span style="font-weight: 400;">, (url: https://github.com/dapphub/ds-test, tag: None)</span>&#13; <span style="font-weight: 400;">    Installed ds-test</span>&#13; <span style="font-weight: 400;">    Initialized forge project.</span>&#13; <span style="font-weight: 400;">❯ Development </span><span style="font-weight: 400;">cd</span><span style="font-weight: 400;"> foundry</span>&#13; <span style="font-weight: 400;">❯ foundry (main) ✔</span></pre> <h3><span style="font-weight: 400;">创建您的第一个测试</span></h3> <p>初始化项目后，Foundry 会在 src 目录下为您创建一个基本合同和测试。</p> <pre><span style="font-weight: 400;">❯ src (main) ✔ tree</span>&#13; <span style="font-weight: 400;">.</span>&#13; <span style="font-weight: 400;">├── Contract.sol</span>&#13; <span style="font-weight: 400;">└── </span><span style="font-weight: 400;">test</span>&#13; <span style="font-weight: 400;">    └── Contract.t.sol</span>&#13; &#13; <span style="font-weight: 400;">1 directory, 2 files</span></pre> <p>这些提供了铸造文件结构的基本概念。您可以删除 Contract.sol 和 Contract.t.sol，因为您将创建您的合同和测试。</p> <pre><span style="font-weight: 400;">❯ src (main) ✔ rm Contract.sol test/Contract.t.sol</span></pre> <p><span style="font-weight: 400;">在测试目录下创建 QuizGame.t.sol。基本骨架应该是这样的。</span></p> <pre><span style="font-weight: 400;">foundry/src/test/QuizGame.t.sol</span>&#13; &#13; <span style="font-weight: 400;">// SPDX-License-Identifier: UNLICENSED</span>&#13; <span style="font-weight: 400;">pragma</span> <span style="font-weight: 400;">solidity</span> <span style="font-weight: 400;">^</span><span style="font-weight: 400;">0.8</span><span style="font-weight: 400;">.</span><span style="font-weight: 400;">13</span><span style="font-weight: 400;">;</span>&#13; &#13; <span style="font-weight: 400;">import</span> <span style="font-weight: 400;">"ds-test/test.sol"</span><span style="font-weight: 400;">;</span>&#13; <span style="font-weight: 400;">import</span> <span style="font-weight: 400;">"../QuizGame.sol"</span><span style="font-weight: 400;">;</span>&#13; <span style="font-weight: 400;">&#13; interface</span> <span style="font-weight: 400;">CheatCodes</span><span style="font-weight: 400;"> {</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">function</span> <span style="font-weight: 400;">deal</span><span style="font-weight: 400;">(</span><span style="font-weight: 400;">address</span><span style="font-weight: 400;">, </span><span style="font-weight: 400;">uint256</span><span style="font-weight: 400;">) </span><span style="font-weight: 400;">external</span><span style="font-weight: 400;">;</span>&#13; <span style="font-weight: 400;">}</span>&#13; &#13; <span style="font-weight: 400;">contract</span> <span style="font-weight: 400;">QuizTest</span> <span style="font-weight: 400;">is</span> <span style="font-weight: 400;">DSTest</span><span style="font-weight: 400;"> {</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">function</span> <span style="font-weight: 400;">setUp</span><span style="font-weight: 400;">() </span><span style="font-weight: 400;">public</span><span style="font-weight: 400;"> {}</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">function</span> <span style="font-weight: 400;">testExample</span><span style="font-weight: 400;">() </span><span style="font-weight: 400;">public</span><span style="font-weight: 400;"> {</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">assertTrue</span><span style="font-weight: 400;">(</span><span style="font-weight: 400;">true</span><span style="font-weight: 400;">);</span>&#13; <span style="font-weight: 400;">    }</span>&#13; <span style="font-weight: 400;">}</span></pre> <p>这将允许你通过 forge 测试来确保一切正常。如果您运行测试，它将会由于 QuizGame 合同不可用而失败。这就开始了测试驱动的开发周期:编写测试，看着它失败，修复测试，看着它通过，然后编写另一个失败的测试。在修复失败的测试之前，您可能会看到类似的错误。恭喜你，你的测试不出所料的失败了！</p> <pre><span style="font-weight: 400;">Error: </span>&#13; <span style="font-weight: 400;">   0: Compiler run failed</span>&#13; <span style="font-weight: 400;">      ParserError: Source </span><span style="font-weight: 400;">"/Users/rg/Development/QuizGame/src/QuizGame.sol"</span><span style="font-weight: 400;"> not found: File not found.</span>&#13; <span style="font-weight: 400;">       --</span><span style="font-weight: 400;">&gt;</span><span style="font-weight: 400;"> /Users/rg/Development/QuizGame/src/test/QuizGame.t.sol:6:1:</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">|</span>&#13; <span style="font-weight: 400;">      6 </span><span style="font-weight: 400;">|</span><span style="font-weight: 400;"> import </span><span style="font-weight: 400;">"../QuizGame.sol"</span><span style="font-weight: 400;">;</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">|</span><span style="font-weight: 400;"> ^^^^^^^^^^^^^^^^^^^^^^^^^</span></pre> <p><span style="font-weight: 400;">在 src 目录下新建一个名为 QuizGame.sol 的文件。</span></p> <pre><span style="font-weight: 400;">foundry/src/QuizGame.sol</span>&#13; &#13; <span style="font-weight: 400;">// SPDX-License-Identifier: UNLICENSED</span>&#13; <span style="font-weight: 400;">pragma</span> <span style="font-weight: 400;">solidity</span> <span style="font-weight: 400;">^</span><span style="font-weight: 400;">0.8</span><span style="font-weight: 400;">.</span><span style="font-weight: 400;">13</span><span style="font-weight: 400;">;</span>&#13; &#13; <span style="font-weight: 400;">contract</span> <span style="font-weight: 400;">QuizGame</span><span style="font-weight: 400;"> {}</span></pre> <p>此时，您的测试应该通过了。</p> <pre><span style="font-weight: 400;">❯ src (main) ✘ forge </span><span style="font-weight: 400;">test</span>&#13; <span style="font-weight: 400;">[⠢] Compiling...</span>&#13; <span style="font-weight: 400;">[⠆] Compiling 2 files with 0.8.13</span>&#13; <span style="font-weight: 400;">[⠰] Solc finished </span><span style="font-weight: 400;">in</span><span style="font-weight: 400;"> 37.90ms</span>&#13; <span style="font-weight: 400;">Compiler run successful</span>&#13; &#13; <span style="font-weight: 400;">Running 1 </span><span style="font-weight: 400;">test</span> <span style="font-weight: 400;">for</span> <span style="font-weight: 400;">src/test/QuizGame.t.sol:QuizTest</span>&#13; <span style="font-weight: 400;">[PASS] testExample() (gas: 190)</span>&#13; <span style="font-weight: 400;">Test result: ok. 1 passed</span><span style="font-weight: 400;">;</span><span style="font-weight: 400;"> 0 failed</span><span style="font-weight: 400;">;</span><span style="font-weight: 400;"> finished </span><span style="font-weight: 400;">in</span><span style="font-weight: 400;"> 1.31ms</span>&#13; &#13; <span style="font-weight: 400;">❯ src (main) ✘</span></pre> <h2><span style="font-weight: 400;">创建测验</span></h2> <p>现在你已经有了游戏合约和测试的框架，你可以编写你的第一个实际测试了。虽然看起来可能不是一个测验，但是您将添加到 setup()函数中的步骤将确保您可以创建一个测验。创建后，您可以检查测验是否正确存储了问题和答案。</p> <pre><span style="font-weight: 400;">foundry/src/test/QuizGame.t.sol</span>&#13; &#13; <span style="font-weight: 400;">contract</span> <span style="font-weight: 400;">QuizTest</span> <span style="font-weight: 400;">is</span> <span style="font-weight: 400;">DSTest</span><span style="font-weight: 400;"> {</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">QuizGame</span> <span style="font-weight: 400;">public</span> <span style="font-weight: 400;">game</span><span style="font-weight: 400;">;</span>&#13; &#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">function</span> <span style="font-weight: 400;">setUp</span><span style="font-weight: 400;">() </span><span style="font-weight: 400;">public</span><span style="font-weight: 400;"> {</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">// The salt means pre-generated dictionaries are not valid</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">bytes32</span> <span style="font-weight: 400;">salt</span> <span style="font-weight: 400;">=</span> <span style="font-weight: 400;">bytes32</span><span style="font-weight: 400;">(</span><span style="font-weight: 400;">"123123123"</span><span style="font-weight: 400;">);</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">// Store the answer to the question</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">string</span> <span style="font-weight: 400;">memory</span> <span style="font-weight: 400;">answer</span> <span style="font-weight: 400;">=</span> <span style="font-weight: 400;">"42"</span><span style="font-weight: 400;">;</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">// Store the question</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">string</span>&#13; <span style="font-weight: 400;">            </span><span style="font-weight: 400;">memory</span> <span style="font-weight: 400;">question</span> <span style="font-weight: 400;">=</span> <span style="font-weight: 400;">"What is the answer to life, the universe, and everything?"</span><span style="font-weight: 400;">;</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">// Store the hashed correct answer</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">bytes32</span> <span style="font-weight: 400;">hashedAnswer</span> <span style="font-weight: 400;">=</span> <span style="font-weight: 400;">keccak256</span><span style="font-weight: 400;">(</span><span style="font-weight: 400;">abi</span><span style="font-weight: 400;">.</span><span style="font-weight: 400;">encodePacked</span><span style="font-weight: 400;">(</span><span style="font-weight: 400;">salt</span><span style="font-weight: 400;">, </span><span style="font-weight: 400;">answer</span><span style="font-weight: 400;">));</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">// Create a new game with the question and hashed answer</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">game</span> <span style="font-weight: 400;">=</span> <span style="font-weight: 400;">new</span> <span style="font-weight: 400;">QuizGame</span><span style="font-weight: 400;">(</span><span style="font-weight: 400;">question</span><span style="font-weight: 400;">, </span><span style="font-weight: 400;">hashedAnswer</span><span style="font-weight: 400;">);</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">emit</span> <span style="font-weight: 400;">log</span><span style="font-weight: 400;">(</span><span style="font-weight: 400;">game</span><span style="font-weight: 400;">.</span><span style="font-weight: 400;">question</span><span style="font-weight: 400;">());</span>&#13; <span style="font-weight: 400;">    }</span>&#13; &#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">function</span> <span style="font-weight: 400;">testExample</span><span style="font-weight: 400;">() </span><span style="font-weight: 400;">public</span><span style="font-weight: 400;"> {</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">assertTrue</span><span style="font-weight: 400;">(</span><span style="font-weight: 400;">true</span><span style="font-weight: 400;">);</span>&#13; <span style="font-weight: 400;">    }</span>&#13; <span style="font-weight: 400;">}</span></pre> <p>要通过测试，请更新您的合同。</p> <pre><span style="font-weight: 400;">foundry/src/QuizGame.sol</span>&#13; &#13; <span style="font-weight: 400;">contract</span> <span style="font-weight: 400;">QuizGame</span><span style="font-weight: 400;"> {</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">// The salt means pre-generated dictionaries are not valid this can be</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">// changed to any value you want</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">bytes32</span> <span style="font-weight: 400;">public</span> <span style="font-weight: 400;">salt</span> <span style="font-weight: 400;">=</span> <span style="font-weight: 400;">bytes32</span><span style="font-weight: 400;">(</span><span style="font-weight: 400;">"123123123"</span><span style="font-weight: 400;">);</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">// Store the answer to the question</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">bytes32</span> <span style="font-weight: 400;">public</span> <span style="font-weight: 400;">hashedAnswer</span><span style="font-weight: 400;">;</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">// Store the question</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">string</span> <span style="font-weight: 400;">public</span> <span style="font-weight: 400;">question</span><span style="font-weight: 400;">;</span>&#13; &#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">// Create the quiz contract with the passed in question and answer</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">constructor</span><span style="font-weight: 400;">(</span><span style="font-weight: 400;">string</span> <span style="font-weight: 400;">memory</span> <span style="font-weight: 400;">_question</span><span style="font-weight: 400;">, </span><span style="font-weight: 400;">bytes32</span> <span style="font-weight: 400;">_hashedAnswer</span><span style="font-weight: 400;">) {</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">// Store the hashed answer</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">hashedAnswer</span> <span style="font-weight: 400;">=</span> <span style="font-weight: 400;">_hashedAnswer</span><span style="font-weight: 400;">;</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">// Store the question</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">question</span> <span style="font-weight: 400;">=</span> <span style="font-weight: 400;">_question</span><span style="font-weight: 400;">;</span>&#13; <span style="font-weight: 400;">    }</span>&#13; <span style="font-weight: 400;">}</span></pre> <p>在这一点上，你的契约将存储一个问题和答案，但它没有做太多其他的事情。</p> <h2><span style="font-weight: 400;">为任何答案创建测试</span></h2> <p>一旦你设置了一个问题，你将需要检查玩家提供的猜测是否与存储在测验合同中的答案相匹配。您需要创建一个您知道会失败的测试。我们认为失败是成功的，因为猜测的答案是不正确的。</p> <pre><span style="font-weight: 400;">foundry/src/test/QuizGame.t.sol</span>&#13; &#13; <span style="font-weight: 400;">function</span> <span style="font-weight: 400;">testQuizFail</span><span style="font-weight: 400;">() </span><span style="font-weight: 400;">public</span><span style="font-weight: 400;"> {</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">// This will fail, that mean you need to catch the failure to 'pass' the test</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">try</span> <span style="font-weight: 400;">game</span><span style="font-weight: 400;">.</span><span style="font-weight: 400;">guess</span><span style="font-weight: 400;">("33") {</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">assertTrue</span><span style="font-weight: 400;">(</span><span style="font-weight: 400;">false</span><span style="font-weight: 400;">);</span>&#13; <span style="font-weight: 400;">    } </span><span style="font-weight: 400;">catch</span><span style="font-weight: 400;"> {</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">assertTrue</span><span style="font-weight: 400;">(</span><span style="font-weight: 400;">true</span><span style="font-weight: 400;">);</span>&#13; <span style="font-weight: 400;">    }</span>&#13; <span style="font-weight: 400;">}</span></pre> <p>这个测试意味着你需要创建一个函数来接受猜测。该功能的一部分是让玩家猜测，并将其与存储的散列答案进行比较。</p> <pre><span style="font-weight: 400;">foundry/src/QuizGame.sol</span>&#13; &#13; <span style="font-weight: 400;">function</span> <span style="font-weight: 400;">guess</span><span style="font-weight: 400;">(</span><span style="font-weight: 400;">string</span> <span style="font-weight: 400;">calldata</span> <span style="font-weight: 400;">answer</span><span style="font-weight: 400;">) </span><span style="font-weight: 400;">public</span><span style="font-weight: 400;"> {</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">// Check if the answer is correct</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">require</span><span style="font-weight: 400;">(</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">keccak256</span><span style="font-weight: 400;">(</span><span style="font-weight: 400;">abi</span><span style="font-weight: 400;">.</span><span style="font-weight: 400;">encodePacked</span><span style="font-weight: 400;">(</span><span style="font-weight: 400;">salt</span><span style="font-weight: 400;">, </span><span style="font-weight: 400;">answer</span><span style="font-weight: 400;">)) </span><span style="font-weight: 400;">==</span> <span style="font-weight: 400;">hashedAnswer</span><span style="font-weight: 400;">,</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">"Incorrect answer"</span>&#13; <span style="font-weight: 400;">    );</span>&#13; <span style="font-weight: 400;">}</span></pre> <p>这个猜测功能将检查答案是否正确，仅此而已。如果答案是正确的，什么也不会发生。为了给正确的猜测提供奖励，您必须将 ETH 发送到合同并支付给正确的玩家。</p> <h2><span style="font-weight: 400;">欺骗交易</span></h2> <p><span style="font-weight: 400;"> Foundry 提供了一套工具来操纵区块链的状态。这些“作弊代码”可以在《铸造之书》中找到。</span></p> <p>您将使用的特定作弊代码是 deal，它将允许您为指定的地址设置余额。在协定之外创建一个接口。</p> <pre><span style="font-weight: 400;">foundry/src/test/QuizGame.t.sol&#13; </span>&#13; <span style="font-weight: 400;">interface</span> <span style="font-weight: 400;">CheatCodes</span><span style="font-weight: 400;"> {</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">function</span> <span style="font-weight: 400;">deal</span><span style="font-weight: 400;">(</span><span style="font-weight: 400;">address</span><span style="font-weight: 400;">, </span><span style="font-weight: 400;">uint256</span><span style="font-weight: 400;">) </span><span style="font-weight: 400;">external</span><span style="font-weight: 400;">;</span>&#13; <span style="font-weight: 400;">}</span></pre> <p><span style="font-weight: 400;">在契约内，你需要使用这个欺骗代码来创建一个常量欺骗。</span></p> <pre><span style="font-weight: 400;">foundry/src/test/QuizGame.t.sol</span>&#13; &#13; <span style="font-weight: 400;">contract</span> <span style="font-weight: 400;">QuizTest</span> <span style="font-weight: 400;">is</span> <span style="font-weight: 400;">DSTest</span><span style="font-weight: 400;"> {</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">CheatCodes</span> <span style="font-weight: 400;">constant</span> <span style="font-weight: 400;">cheats</span> <span style="font-weight: 400;">=</span> <span style="font-weight: 400;">CheatCodes</span><span style="font-weight: 400;">(</span><span style="font-weight: 400;">HEVM_ADDRESS</span><span style="font-weight: 400;">);</span>&#13; <span style="font-weight: 400;">.</span>&#13; <span style="font-weight: 400;">.</span>&#13; <span style="font-weight: 400;">.</span></pre> <p>这将允许您创建一个新的测试，向合同发送一些 ETH，然后提交一个正确的答案。</p> <pre><span style="font-weight: 400;">foundry/src/test/QuizGame.t.sol</span>&#13; &#13; <span style="font-weight: 400;">function</span> <span style="font-weight: 400;">testQuizPass</span><span style="font-weight: 400;">() </span><span style="font-weight: 400;">public</span><span style="font-weight: 400;"> {</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">// Get the current balance of this contract</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">uint256</span> <span style="font-weight: 400;">beginBalance</span> <span style="font-weight: 400;">=</span> <span style="font-weight: 400;">address</span><span style="font-weight: 400;">(</span><span style="font-weight: 400;">this</span><span style="font-weight: 400;">)</span><span style="font-weight: 400;">.</span><span style="font-weight: 400;">balance</span><span style="font-weight: 400;">;</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">// Fund the contract</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">cheats</span><span style="font-weight: 400;">.</span><span style="font-weight: 400;">deal</span><span style="font-weight: 400;">(</span><span style="font-weight: 400;">address</span><span style="font-weight: 400;">(</span><span style="font-weight: 400;">game</span><span style="font-weight: 400;">), </span><span style="font-weight: 400;">10000</span><span style="font-weight: 400;">);</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">// Guess the correct answer</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">game</span><span style="font-weight: 400;">.</span><span style="font-weight: 400;">guess</span><span style="font-weight: 400;">(</span><span style="font-weight: 400;">"42"</span><span style="font-weight: 400;">);</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">// Check balance after the guess is 10000 more than before</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">assertEq</span><span style="font-weight: 400;">(</span><span style="font-weight: 400;">address</span><span style="font-weight: 400;">(</span><span style="font-weight: 400;">this</span><span style="font-weight: 400;">)</span><span style="font-weight: 400;">.</span><span style="font-weight: 400;">balance</span><span style="font-weight: 400;">, </span><span style="font-weight: 400;">beginBalance</span> <span style="font-weight: 400;">+</span> <span style="font-weight: 400;">10000</span><span style="font-weight: 400;">);</span>&#13; <span style="font-weight: 400;">}</span></pre> <p><span style="font-weight: 400;">我们的目标是通过测验的正确答案来支付测试合同的费用。为此，您需要创建一个 fallback()和 receive()函数。</span></p> <pre><span style="font-weight: 400;">foundry/src/test/QuizGame.t.sol</span>&#13; &#13; <span style="font-weight: 400;">fallback</span><span style="font-weight: 400;">() </span><span style="font-weight: 400;">external</span> <span style="font-weight: 400;">payable</span><span style="font-weight: 400;"> {}</span>&#13; &#13; <span style="font-weight: 400;">receive</span><span style="font-weight: 400;">() </span><span style="font-weight: 400;">external</span> <span style="font-weight: 400;">payable</span><span style="font-weight: 400;"> {}</span></pre> <h2><span style="font-weight: 400;">回答问题</span></h2> <p>当一个问题被正确回答时，合同应该把它的余额转移给猜测者。</p> <pre><span style="font-weight: 400;">foundry/src/QuizGame.sol</span>&#13; &#13; <span style="font-weight: 400;">function</span> <span style="font-weight: 400;">guess</span><span style="font-weight: 400;">(</span><span style="font-weight: 400;">string</span> <span style="font-weight: 400;">calldata</span> <span style="font-weight: 400;">answer</span><span style="font-weight: 400;">) </span><span style="font-weight: 400;">public</span><span style="font-weight: 400;"> {</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">require</span><span style="font-weight: 400;">(</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">keccak256</span><span style="font-weight: 400;">(</span><span style="font-weight: 400;">abi</span><span style="font-weight: 400;">.</span><span style="font-weight: 400;">encodePacked</span><span style="font-weight: 400;">(</span><span style="font-weight: 400;">salt</span><span style="font-weight: 400;">, </span><span style="font-weight: 400;">answer</span><span style="font-weight: 400;">)) </span><span style="font-weight: 400;">==</span> <span style="font-weight: 400;">hashedAnswer</span><span style="font-weight: 400;">,</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">"Incorrect answer"</span>&#13; <span style="font-weight: 400;">    );</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">// If the contract has a balance, and the answer is correct,</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">if</span><span style="font-weight: 400;"> (</span><span style="font-weight: 400;">address</span><span style="font-weight: 400;">(</span><span style="font-weight: 400;">this</span><span style="font-weight: 400;">)</span><span style="font-weight: 400;">.</span><span style="font-weight: 400;">balance</span> <span style="font-weight: 400;">&gt;</span> <span style="font-weight: 400;">0</span><span style="font-weight: 400;">) {</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">// send the balance to the guesser</span>&#13; <span style="font-weight: 400;">        <span class="x x-first x-last">(bool sent, bytes memory data) = </span>payable(msg.sender).<span class="x x-first x-last">call{value: </span>address(this).balance<span class="x x-first x-last">}(""</span>);</span>&#13; <span style="font-weight: 400;">    }</span>&#13; <span style="font-weight: 400;">}</span>&#13; <span style="font-weight: 400;">fallback</span><span style="font-weight: 400;">() </span><span style="font-weight: 400;">external</span> <span style="font-weight: 400;">payable</span><span style="font-weight: 400;"> {</span>&#13; <span style="font-weight: 400;">}</span>&#13; &#13; <span style="font-weight: 400;">receive</span><span style="font-weight: 400;">() </span><span style="font-weight: 400;">external</span> <span style="font-weight: 400;">payable</span><span style="font-weight: 400;"> {</span>&#13; <span style="font-weight: 400;">}</span></pre> <p><span style="font-weight: 400;">妙极了！此时，您已经有了一份完全有效的测验合同。在开始前端工作之前，还有几个步骤来完成可靠性工作。首先，您需要在 QuizGame 契约中创建一些事件。</span></p> <h2><span style="font-weight: 400;">添加事件</span></h2> <p><span style="font-weight: 400;">事件将允许你监听契约状态的变化。对于测验，您需要为测验的资金和正确猜测创建一个事件。</span></p> <p><span style="font-weight: 400;">在契约的顶部，添加这两个事件。在</span>之后添加它们</p> <pre><span style="font-weight: 400;">string</span> <span style="font-weight: 400;">public</span> <span style="font-weight: 400;">quesiton</span><span style="font-weight: 400;">;</span>&#13; </pre> <pre><span style="font-weight: 400;">foundry/src/QuizGame.sol</span>&#13; &#13; <span style="font-weight: 400;">event</span> <span style="font-weight: 400;">QuizFunded</span><span style="font-weight: 400;">(</span><span style="font-weight: 400;">uint256</span> <span style="font-weight: 400;">balance</span><span style="font-weight: 400;">);</span>&#13; <span style="font-weight: 400;">event</span> <span style="font-weight: 400;">AnswerGuessed</span><span style="font-weight: 400;">();</span></pre> <p><span style="font-weight: 400;">在猜测函数的末尾，加上:</span></p> <pre><span style="font-weight: 400;">emit</span> <span style="font-weight: 400;">AnswerGuessed</span><span style="font-weight: 400;">();</span></pre> <p><span style="font-weight: 400;">将以下内容添加到回退和接收功能中，添加:</span></p> <pre><span style="font-weight: 400;">emit</span> <span style="font-weight: 400;">QuizFunded</span><span style="font-weight: 400;">(</span><span style="font-weight: 400;">address</span><span style="font-weight: 400;">(</span><span style="font-weight: 400;">this</span><span style="font-weight: 400;">)</span><span style="font-weight: 400;">.</span><span style="font-weight: 400;">balance</span><span style="font-weight: 400;">);</span></pre> <h2><span style="font-weight: 400;">创建工厂</span></h2> <p>你的问答游戏的最后一块拼图是工厂。工厂合同到底是什么？工厂合同是创建一组其他合同并跟踪它们的合同。您将需要为工厂、合同和测试创建两个新文件。</p> <pre><span style="font-weight: 400;">foundry/src/test/QuizFactory.t.sol</span>&#13; &#13; <span style="font-weight: 400;">// SPDX-License-Identifier: UNLICENSED</span>&#13; <span style="font-weight: 400;">pragma</span> <span style="font-weight: 400;">solidity</span> <span style="font-weight: 400;">^</span><span style="font-weight: 400;">0.8</span><span style="font-weight: 400;">.</span><span style="font-weight: 400;">13</span><span style="font-weight: 400;">;</span>&#13; &#13; <span style="font-weight: 400;">import</span> <span style="font-weight: 400;">"ds-test/test.sol"</span><span style="font-weight: 400;">;</span>&#13; <span style="font-weight: 400;">import</span> <span style="font-weight: 400;">"../QuizFactory.sol"</span><span style="font-weight: 400;">;</span>&#13; &#13; <span style="font-weight: 400;">contract</span> <span style="font-weight: 400;">QuizFactoryTest</span> <span style="font-weight: 400;">is</span> <span style="font-weight: 400;">DSTest</span><span style="font-weight: 400;"> {</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">QuizFactory</span> <span style="font-weight: 400;">public</span> <span style="font-weight: 400;">factory</span><span style="font-weight: 400;">;</span>&#13; &#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">function</span> <span style="font-weight: 400;">setUp</span><span style="font-weight: 400;">() </span><span style="font-weight: 400;">public</span><span style="font-weight: 400;"> {</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">factory</span> <span style="font-weight: 400;">=</span> <span style="font-weight: 400;">new</span> <span style="font-weight: 400;">QuizFactory</span><span style="font-weight: 400;">();</span>&#13; <span style="font-weight: 400;">    }</span>&#13; <span style="font-weight: 400;">}</span>&#13; </pre> <pre><span style="font-weight: 400;">foundry/src/QuizFactory.sol</span>&#13; &#13; <span style="font-weight: 400;">// SPDX-License-Identifier: UNLICENSED</span>&#13; <span style="font-weight: 400;">pragma</span> <span style="font-weight: 400;">solidity</span> <span style="font-weight: 400;">^</span><span style="font-weight: 400;">0.8</span><span style="font-weight: 400;">.</span><span style="font-weight: 400;">13</span><span style="font-weight: 400;">;</span>&#13; &#13; <span style="font-weight: 400;">import</span> <span style="font-weight: 400;">"./QuizGame.sol"</span><span style="font-weight: 400;">;</span>&#13; <span style="font-weight: 400;">&#13; contract</span> <span style="font-weight: 400;">QuizFactory</span><span style="font-weight: 400;"> {</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">constructor</span><span style="font-weight: 400;">() {}</span>&#13; <span style="font-weight: 400;">}</span></pre> <p>这个基本工厂还需要一些额外的东西。首先，您应该添加一个测试来测试通过工厂创建的测验。</p> <h2><span style="font-weight: 400;">从工厂创建测验</span></h2> <p><span style="font-weight: 400;">第一步是添加一个测试，根据工厂合同创建一个测验。</span></p> <pre><span style="font-weight: 400;">foundry/src/test/QuizFactory.t.sol</span>&#13; &#13; <span style="font-weight: 400;">function</span> <span style="font-weight: 400;">testCreateQuiz</span><span style="font-weight: 400;">() </span><span style="font-weight: 400;">public</span><span style="font-weight: 400;"> {</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">// Set Answer</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">string</span> <span style="font-weight: 400;">memory</span> <span style="font-weight: 400;">answer</span> <span style="font-weight: 400;">=</span> <span style="font-weight: 400;">"42"</span><span style="font-weight: 400;">;</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">// Set Question</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">string</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">memory</span> <span style="font-weight: 400;">question</span> <span style="font-weight: 400;">=</span> <span style="font-weight: 400;">"What is the answer to life, the universe, and everything?"</span><span style="font-weight: 400;">;</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">// Set Hashed Answer</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">bytes32</span> <span style="font-weight: 400;">salt</span> <span style="font-weight: 400;">=</span> <span style="font-weight: 400;">bytes32</span><span style="font-weight: 400;">(</span><span style="font-weight: 400;">"123123123"</span><span style="font-weight: 400;">);</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">bytes32</span> <span style="font-weight: 400;">hashedAnswer</span> <span style="font-weight: 400;">=</span> <span style="font-weight: 400;">keccak256</span><span style="font-weight: 400;">(</span><span style="font-weight: 400;">abi</span><span style="font-weight: 400;">.</span><span style="font-weight: 400;">encodePacked</span><span style="font-weight: 400;">(</span><span style="font-weight: 400;">salt</span><span style="font-weight: 400;">, </span><span style="font-weight: 400;">answer</span><span style="font-weight: 400;">));</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">// Create a new quiz with the question and hashed answer</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">factory</span><span style="font-weight: 400;">.</span><span style="font-weight: 400;">createQuiz</span><span style="font-weight: 400;">(</span><span style="font-weight: 400;">question</span><span style="font-weight: 400;">, </span><span style="font-weight: 400;">hashedAnswer</span><span style="font-weight: 400;">);</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">// Get the new quiz</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">QuizGame</span> <span style="font-weight: 400;">quiz</span> <span style="font-weight: 400;">=</span> <span style="font-weight: 400;">factory</span><span style="font-weight: 400;">.</span><span style="font-weight: 400;">quizzes</span><span style="font-weight: 400;">(</span><span style="font-weight: 400;">0</span><span style="font-weight: 400;">);</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">// Check the question</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">assertEq</span><span style="font-weight: 400;">(</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">keccak256</span><span style="font-weight: 400;">(</span><span style="font-weight: 400;">abi</span><span style="font-weight: 400;">.</span><span style="font-weight: 400;">encodePacked</span><span style="font-weight: 400;">(</span><span style="font-weight: 400;">quiz</span><span style="font-weight: 400;">.</span><span style="font-weight: 400;">question</span><span style="font-weight: 400;">())),</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">keccak256</span><span style="font-weight: 400;">(</span><span style="font-weight: 400;">abi</span><span style="font-weight: 400;">.</span><span style="font-weight: 400;">encodePacked</span><span style="font-weight: 400;">(</span><span style="font-weight: 400;">question</span><span style="font-weight: 400;">))</span>&#13; <span style="font-weight: 400;">    );</span>&#13; <span style="font-weight: 400;">}</span></pre> <p><span style="font-weight: 400;">这项测试需要几样东西。首先，一个</span> <span style="font-weight: 400;"> <code>createQuiz</code> </span> <span style="font-weight: 400;">功能。它还希望您有一种方法来引用工厂合同中的测验。您将需要创建一个 QuizGames 数组，该数组将公开提供。</span></p> <p><span style="font-weight: 400;">在您的 QuizFactory 合同顶部设置阵列。有一个活动也不错。当你开始构建前端，你未来的自己会感谢你。</span></p> <pre><span style="font-weight: 400;">foundry/src/QuizFactory.sol</span>&#13; &#13; <span style="font-weight: 400;">QuizGame</span><span style="font-weight: 400;">[] </span><span style="font-weight: 400;">public</span> <span style="font-weight: 400;">quizzes</span><span style="font-weight: 400;">;</span>&#13; <span style="font-weight: 400;">event</span> <span style="font-weight: 400;">QuizCreated</span><span style="font-weight: 400;">(</span><span style="font-weight: 400;">QuizGame</span> <span style="font-weight: 400;">indexed</span> <span style="font-weight: 400;">quiz</span><span style="font-weight: 400;">, </span><span style="font-weight: 400;">address</span> <span style="font-weight: 400;">indexed</span> <span style="font-weight: 400;">creator</span><span style="font-weight: 400;">);</span></pre> <p><span style="font-weight: 400;">现在你可以构建 createQuiz 函数</span></p> <pre><span style="font-weight: 400;">foundry/src/QuizFactory.sol</span>&#13; &#13; <span style="font-weight: 400;">function</span> <span style="font-weight: 400;">createQuiz</span><span style="font-weight: 400;">(</span><span style="font-weight: 400;">string</span> <span style="font-weight: 400;">memory</span> <span style="font-weight: 400;">_question</span><span style="font-weight: 400;">, </span><span style="font-weight: 400;">bytes32</span> <span style="font-weight: 400;">_answer</span><span style="font-weight: 400;">) </span><span style="font-weight: 400;">public</span><span style="font-weight: 400;"> {</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">// Create a new quiz</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">QuizGame</span> <span style="font-weight: 400;">quiz</span> <span style="font-weight: 400;">=</span> <span style="font-weight: 400;">new</span> <span style="font-weight: 400;">QuizGame</span><span style="font-weight: 400;">(</span><span style="font-weight: 400;">_question</span><span style="font-weight: 400;">, </span><span style="font-weight: 400;">_answer</span><span style="font-weight: 400;">);</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">// Add it to the list of quizzes</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">quizzes</span><span style="font-weight: 400;">.</span><span style="font-weight: 400;">push</span><span style="font-weight: 400;">(</span><span style="font-weight: 400;">quiz</span><span style="font-weight: 400;">);</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">// Emit the event</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">emit</span> <span style="font-weight: 400;">QuizCreated</span><span style="font-weight: 400;">(</span><span style="font-weight: 400;">quiz</span><span style="font-weight: 400;">, </span><span style="font-weight: 400;">msg</span><span style="font-weight: 400;">.</span><span style="font-weight: 400;">sender</span><span style="font-weight: 400;">);</span>&#13; <span style="font-weight: 400;">}</span></pre> <p>您可以添加测验，返回工厂创建的所有测验会很有帮助。</p> <pre><span style="font-weight: 400;">foundry/src/test/QuizFactory.t.sol</span>&#13; &#13; <span style="font-weight: 400;">function</span> <span style="font-weight: 400;">testCountquizzes</span><span style="font-weight: 400;">() </span><span style="font-weight: 400;">public</span><span style="font-weight: 400;"> {</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">// Set Answer</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">string</span> <span style="font-weight: 400;">memory</span> <span style="font-weight: 400;">answer</span> <span style="font-weight: 400;">=</span> <span style="font-weight: 400;">"42"</span><span style="font-weight: 400;">;</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">// Set Question</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">string</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">memory</span> <span style="font-weight: 400;">question</span> <span style="font-weight: 400;">=</span> <span style="font-weight: 400;">"What is the answer to life, the universe, and everything?"</span><span style="font-weight: 400;">;</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">// Set Hashed Answer</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">bytes32</span> <span style="font-weight: 400;">salt</span> <span style="font-weight: 400;">=</span> <span style="font-weight: 400;">bytes32</span><span style="font-weight: 400;">(</span><span style="font-weight: 400;">"123123123"</span><span style="font-weight: 400;">);</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">bytes32</span> <span style="font-weight: 400;">hashedAnswer</span> <span style="font-weight: 400;">=</span> <span style="font-weight: 400;">keccak256</span><span style="font-weight: 400;">(</span><span style="font-weight: 400;">abi</span><span style="font-weight: 400;">.</span><span style="font-weight: 400;">encodePacked</span><span style="font-weight: 400;">(</span><span style="font-weight: 400;">salt</span><span style="font-weight: 400;">, </span><span style="font-weight: 400;">answer</span><span style="font-weight: 400;">));</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">// Create two new quizzes</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">factory</span><span style="font-weight: 400;">.</span><span style="font-weight: 400;">createQuiz</span><span style="font-weight: 400;">(</span><span style="font-weight: 400;">question</span><span style="font-weight: 400;">, </span><span style="font-weight: 400;">hashedAnswer</span><span style="font-weight: 400;">);</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">factory</span><span style="font-weight: 400;">.</span><span style="font-weight: 400;">createQuiz</span><span style="font-weight: 400;">(</span><span style="font-weight: 400;">question</span><span style="font-weight: 400;">, </span><span style="font-weight: 400;">hashedAnswer</span><span style="font-weight: 400;">);</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">// Get all the quizzes</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">QuizGame</span><span style="font-weight: 400;">[] </span><span style="font-weight: 400;">memory</span> <span style="font-weight: 400;">quizzes</span> <span style="font-weight: 400;">=</span> <span style="font-weight: 400;">factory</span><span style="font-weight: 400;">.</span><span style="font-weight: 400;">getQuizzes</span><span style="font-weight: 400;">();</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">// Check the number of quizzes</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">assertEq</span><span style="font-weight: 400;">(</span><span style="font-weight: 400;">quizzes</span><span style="font-weight: 400;">.</span><span style="font-weight: 400;">length</span><span style="font-weight: 400;">, </span><span style="font-weight: 400;">2</span><span style="font-weight: 400;">);</span>&#13; <span style="font-weight: 400;">}</span></pre> <p>该测试检查返回的测验数量是否符合您的预期。您需要创建函数 getQuizzes，它应该返回一个 QuizGames 数组</p> <pre><span style="font-weight: 400;">foundry/src/test/QuizFactory.sol</span>&#13; &#13; <span style="font-weight: 400;">function</span> <span style="font-weight: 400;">getQuizzes</span><span style="font-weight: 400;">() </span><span style="font-weight: 400;">public</span> <span style="font-weight: 400;">view</span> <span style="font-weight: 400;">returns</span><span style="font-weight: 400;"> (</span><span style="font-weight: 400;">QuizGame</span><span style="font-weight: 400;">[] </span><span style="font-weight: 400;">memory</span> <span style="font-weight: 400;">col</span><span style="font-weight: 400;">) {</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">// Calculate number of quizzes</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">uint256</span> <span style="font-weight: 400;">size</span> <span style="font-weight: 400;">=</span> <span style="font-weight: 400;">quizzes</span><span style="font-weight: 400;">.</span><span style="font-weight: 400;">length</span><span style="font-weight: 400;">;</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">// Create a new array for the quizzes</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">col</span> <span style="font-weight: 400;">=</span> <span style="font-weight: 400;">new</span> <span style="font-weight: 400;">QuizGame</span><span style="font-weight: 400;">[](</span><span style="font-weight: 400;">size</span><span style="font-weight: 400;">);</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">// Copy the quizzes to the new array</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">for</span><span style="font-weight: 400;"> (</span><span style="font-weight: 400;">uint256</span> <span style="font-weight: 400;">i</span> <span style="font-weight: 400;">=</span> <span style="font-weight: 400;">0</span><span style="font-weight: 400;">; </span><span style="font-weight: 400;">i</span> <span style="font-weight: 400;">&lt;</span> <span style="font-weight: 400;">size</span><span style="font-weight: 400;">; </span><span style="font-weight: 400;">i</span><span style="font-weight: 400;">++</span><span style="font-weight: 400;">) {</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">col</span><span style="font-weight: 400;">[</span><span style="font-weight: 400;">i</span><span style="font-weight: 400;">] </span><span style="font-weight: 400;">=</span> <span style="font-weight: 400;">quizzes</span><span style="font-weight: 400;">[</span><span style="font-weight: 400;">i</span><span style="font-weight: 400;">];</span>&#13; <span style="font-weight: 400;">    }</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">// Return the array</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">return</span> <span style="font-weight: 400;">col</span><span style="font-weight: 400;">;</span>&#13; <span style="font-weight: 400;">}</span></pre> <h2><span style="font-weight: 400;">合同完成！</span></h2> <p>你做到了！合同已准备好部署！您可以使用这个脚本来部署它。将其保存在项目的根目录下。</p> <pre><span style="font-weight: 400;">deploy.sh</span>&#13; &#13; <span style="font-weight: 400;">#!/usr/bin/env bash</span>&#13; &#13; <span style="font-weight: 400;"># Read the RPC URL</span>&#13; <span style="font-weight: 400;">echo</span><span style="font-weight: 400;"> Enter Your RPC URL:</span>&#13; <span style="font-weight: 400;">echo</span><span style="font-weight: 400;"> Example: </span><span style="font-weight: 400;">"https://eth-goerli.alchemyapi.io/v2//XXXXXXXXXX"</span>&#13; <span style="font-weight: 400;">read</span><span style="font-weight: 400;"> -s rpc</span>&#13; &#13; <span style="font-weight: 400;"># Read the contract name</span>&#13; <span style="font-weight: 400;">echo</span><span style="font-weight: 400;"> Which contract </span><span style="font-weight: 400;">do</span><span style="font-weight: 400;"> you want to deploy </span><span style="font-weight: 400;">\(</span><span style="font-weight: 400;">eg Greeter</span><span style="font-weight: 400;">\)</span><span style="font-weight: 400;">?</span>&#13; <span style="font-weight: 400;">read</span><span style="font-weight: 400;"> contract</span>&#13; &#13; <span style="font-weight: 400;">forge create ./src/</span><span style="font-weight: 400;">${contract}</span><span style="font-weight: 400;">.sol:</span><span style="font-weight: 400;">${contract}</span><span style="font-weight: 400;"> -i --rpc-url </span><span style="font-weight: 400;">$rpc</span></pre> <p>这将允许您将您的合同部署到 Goerli，所有这些都是读取变量，而不显示您在命令行上键入的内容。这将确保您的私钥不会存储在您的命令行历史中。</p> <p>运行 deploy.sh 后，您应该会看到您的合同部署到了哪里。在下一节构建前端时，您将需要这个地址。</p> <pre><span style="font-weight: 400;">Deployer: 0x0000000000000000000000000000000000000000</span>&#13; <span style="font-weight: 400;">Deployed to: 0x1234567890123456789012345678901234567890</span>&#13; <span style="font-weight: 400;">Transaction hash: 0x1234567890123456789012345678901234567890594be2f670606ada53412aaa</span></pre> <h2><span style="font-weight: 400;">苗条安装</span></h2> <p>初始化苗条很简单。要看说明，可以前往 <a href="https://kit.svelte.dev/"> <span style="font-weight: 400;">苗条主页</span> </a> <span style="font-weight: 400;">。对于本教程，您应该使用以下内容。这将在 Svelte 目录中创建一个 SvelteKit 框架项目。</span></p> <pre><span style="font-weight: 400;">❯ QuizGame (main) ✘ npm init svelte svelte</span>&#13; <span style="font-weight: 400;">Need to install the following packages:</span>&#13; <span style="font-weight: 400;">  create-svelte</span>&#13; <span style="font-weight: 400;">Ok to proceed</span><span style="font-weight: 400;">?</span><span style="font-weight: 400;"> (y) y</span>&#13; <span style="font-weight: 400;">create-svelte version 2.0.0-next.139</span>&#13; <span style="font-weight: 400;">Welcome to SvelteKit</span><span style="font-weight: 400;">!</span>&#13; <span style="font-weight: 400;">This is beta software</span><span style="font-weight: 400;">;</span><span style="font-weight: 400;"> expect bugs and missing features.</span>&#13; <span style="font-weight: 400;">Problems</span><span style="font-weight: 400;">?</span><span style="font-weight: 400;"> Open an issue on https://github.com/sveltejs/kit/issues </span><span style="font-weight: 400;">if</span><span style="font-weight: 400;"> none exists already.</span>&#13; <span style="font-weight: 400;">✔ Which Svelte app template</span><span style="font-weight: 400;">?</span><span style="font-weight: 400;"> › Skeleton project</span>&#13; <span style="font-weight: 400;">✔ Add </span><span style="font-weight: 400;">type</span><span style="font-weight: 400;"> checking</span><span style="font-weight: 400;">?</span><span style="font-weight: 400;"> › None</span>&#13; <span style="font-weight: 400;">✔ Add ESLint </span><span style="font-weight: 400;">for</span> <span style="font-weight: 400;">code</span><span style="font-weight: 400;"> linting</span><span style="font-weight: 400;">?</span><span style="font-weight: 400;"> … Yes</span>&#13; <span style="font-weight: 400;">✔ Add Prettier </span><span style="font-weight: 400;">for</span> <span style="font-weight: 400;">code</span><span style="font-weight: 400;"> formatting</span><span style="font-weight: 400;">?</span><span style="font-weight: 400;"> … Yes</span>&#13; <span style="font-weight: 400;">✔ Add Playwright </span><span style="font-weight: 400;">for</span> <span style="font-weight: 400;">browser</span><span style="font-weight: 400;"> testing</span><span style="font-weight: 400;">?</span><span style="font-weight: 400;"> … No</span>&#13; <span style="font-weight: 400;">Your project is ready</span><span style="font-weight: 400;">!</span>&#13; <span style="font-weight: 400;">✔ ESLint</span>&#13; <span style="font-weight: 400;">  https://github.com/sveltejs/eslint-plugin-svelte3</span>&#13; <span style="font-weight: 400;">✔ Prettier</span>&#13; <span style="font-weight: 400;">  https://prettier.io/docs/en/options.html</span>&#13; <span style="font-weight: 400;">  https://github.com/sveltejs/prettier-plugin-svelte#options</span>&#13; &#13; <span style="font-weight: 400;">Install community-maintained integrations:</span>&#13; <span style="font-weight: 400;">  https://github.com/svelte-add/svelte-adders</span>&#13; &#13; <span style="font-weight: 400;">Next steps:</span>&#13; <span style="font-weight: 400;">  1: </span><span style="font-weight: 400;">cd</span><span style="font-weight: 400;"> svelte</span>&#13; <span style="font-weight: 400;">  2: npm install (or pnpm install, etc)</span>&#13; <span style="font-weight: 400;">  3: git init </span><span style="font-weight: 400;">&amp;&amp;</span><span style="font-weight: 400;"> git add -A </span><span style="font-weight: 400;">&amp;&amp;</span><span style="font-weight: 400;"> git commit -m </span><span style="font-weight: 400;">"Initial commit"</span><span style="font-weight: 400;"> (optional)</span>&#13; <span style="font-weight: 400;">  4: npm run dev -- --open</span>&#13; <span style="font-weight: 400;">To close the dev server, hit Ctrl-C</span>&#13; <span style="font-weight: 400;">&#13; Stuck</span><span style="font-weight: 400;">?</span><span style="font-weight: 400;"> Visit us at https://svelte.dev/chat</span>&#13; <span style="font-weight: 400;">❯ QuizGame (main) ✘ </span><span style="font-weight: 400;">cd</span><span style="font-weight: 400;"> svelte</span></pre> <p><span style="font-weight: 400;">你还需要在项目中添加醚</span></p> <pre><span style="font-weight: 400;">❯ svelte (main) ✘ npm install ethers</span>&#13; <span style="font-weight: 400;">added 43 packages, and audited 180 packages </span><span style="font-weight: 400;">in</span><span style="font-weight: 400;"> 1s</span>&#13; <span style="font-weight: 400;">51 packages are looking </span><span style="font-weight: 400;">for</span> <span style="font-weight: 400;">funding</span>&#13; <span style="font-weight: 400;">  run </span><span style="font-weight: 400;">`npm fund`</span> <span style="font-weight: 400;">for</span> <span style="font-weight: 400;">details</span>&#13; <span style="font-weight: 400;">found 0 vulnerabilities</span></pre> <p>你应该能够启动服务器并看到下面的页面。</p> <pre><span style="font-weight: 400;">npm run dev -- --open</span></pre> <p><img decoding="async" loading="lazy" class="alignnone wp-image-3943 size-full" src="../Images/ccdbd94912348787675e1a789f19154a.png" alt="Screenshot of SvelteKit" width="1208" height="374" srcset="https://blog.chain.link/wp-content/uploads/2022/06/unnamed.png 1208w, https://blog.chain.link/wp-content/uploads/2022/06/unnamed-300x93.png 300w, https://blog.chain.link/wp-content/uploads/2022/06/unnamed-1024x317.png 1024w, https://blog.chain.link/wp-content/uploads/2022/06/unnamed-768x238.png 768w, https://blog.chain.link/wp-content/uploads/2022/06/unnamed-24x7.png 24w, https://blog.chain.link/wp-content/uploads/2022/06/unnamed-36x11.png 36w, https://blog.chain.link/wp-content/uploads/2022/06/unnamed-48x15.png 48w" sizes="(max-width: 1208px) 100vw, 1208px" data-original-src="https://blog.chain.link/wp-content/uploads/2022/06/unnamed.png"/></p> <h2><span style="font-weight: 400;">连接您的钱包</span></h2> <p><span style="font-weight: 400;">你将需要在</span> <span style="font-weight: 400;"> <code>svelte/src/lib</code> </span> <span style="font-weight: 400;">目录下创建一个组件，你还将需要创建这个</span> <span style="font-weight: 400;"> <code>lib</code> </span> <span style="font-weight: 400;">目录。为了开始并确保一切正常，现在在组件中创建一个按钮。</span></p> <pre><span style="font-weight: 400;">svelte/src/lib/WalletConnect.svelte</span>&#13; &#13; <span style="font-weight: 400;">&lt;</span><span style="font-weight: 400;">button</span><span style="font-weight: 400;">&gt;Attach Wallet&lt;/</span><span style="font-weight: 400;">button</span><span style="font-weight: 400;">&gt;</span></pre> <p><span style="font-weight: 400;">然后在</span> <span style="font-weight: 400;"> <code>svelte/src/routes/index.svelte</code> </span> <span style="font-weight: 400;">内，就可以导入这个新组件了。在完全充实组件之前，确保组件被正确导入是一个很好的实践。它还允许您在通过热重装构建组件时看到增量更改。</span></p> <pre><span style="font-weight: 400;">svelte/src/routes/index.svelte</span>&#13; &#13; <span style="font-weight: 400;">&lt;</span><span style="font-weight: 400;">script</span><span style="font-weight: 400;">&gt;</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">import</span> <span style="font-weight: 400;">WalletConnect</span> <span style="font-weight: 400;">from</span> <span style="font-weight: 400;">'$lib/WalletConnect.svelte'</span><span style="font-weight: 400;">;</span>&#13; <span style="font-weight: 400;">&lt;/</span><span style="font-weight: 400;">script</span><span style="font-weight: 400;">&gt;</span>&#13; &#13; <span style="font-weight: 400;">&lt;</span><span style="font-weight: 400;">h1</span><span style="font-weight: 400;">&gt;My Quiz&lt;/</span><span style="font-weight: 400;">h1</span><span style="font-weight: 400;">&gt;</span>&#13; &#13; <span style="font-weight: 400;">&lt;</span><span style="font-weight: 400;">WalletConnect</span><span style="font-weight: 400;"> /&gt;</span></pre> <p>这将为您的页面提供以下更改。</p> <p><img decoding="async" loading="lazy" class="alignnone wp-image-3944 size-full" src="../Images/b281f04c067bde01e5fd9fb99c2ad4b2.png" alt="Svelte My Quiz" width="800" height="334" srcset="https://blog.chain.link/wp-content/uploads/2022/06/unnamed-1.png 800w, https://blog.chain.link/wp-content/uploads/2022/06/unnamed-1-300x125.png 300w, https://blog.chain.link/wp-content/uploads/2022/06/unnamed-1-768x321.png 768w, https://blog.chain.link/wp-content/uploads/2022/06/unnamed-1-24x10.png 24w, https://blog.chain.link/wp-content/uploads/2022/06/unnamed-1-36x15.png 36w, https://blog.chain.link/wp-content/uploads/2022/06/unnamed-1-48x20.png 48w" sizes="(max-width: 800px) 100vw, 800px" data-original-src="https://blog.chain.link/wp-content/uploads/2022/06/unnamed-1.png"/></p> <p>一旦这个工作正常，我们就可以构建其余的组件了。我以后不会演示这些步骤，但是请记住在导入组件之前创建它们。</p> <p><span style="font-weight: 400;">为了在组件之间传递契约和钱包，您需要创建一个存储它们的地方。您可以创建一个</span> <span style="font-weight: 400;"> <code>web3Props</code> </span> <span style="font-weight: 400;">对象来保存这些信息。</span></p> <pre><span style="font-weight: 400;">svelte/src/lib/WalletConnect.svelte</span>&#13; &#13; <span style="font-weight: 400;">&lt;</span><span style="font-weight: 400;">script</span><span style="font-weight: 400;">&gt;</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">import</span><span style="font-weight: 400;"> { </span><span style="font-weight: 400;">ethers</span><span style="font-weight: 400;"> } </span><span style="font-weight: 400;">from</span> <span style="font-weight: 400;">'ethers'</span><span style="font-weight: 400;">;</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">// place holder for the properties we will be passing between components</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">export</span> <span style="font-weight: 400;">let</span> <span style="font-weight: 400;">web3Props</span> <span style="font-weight: 400;">=</span><span style="font-weight: 400;"> { </span><span style="font-weight: 400;">provider</span><span style="font-weight: 400;">:</span> <span style="font-weight: 400;">null</span><span style="font-weight: 400;">, </span><span style="font-weight: 400;">signer</span><span style="font-weight: 400;">:</span> <span style="font-weight: 400;">null</span><span style="font-weight: 400;">, </span><span style="font-weight: 400;">account</span><span style="font-weight: 400;">:</span> <span style="font-weight: 400;">null</span><span style="font-weight: 400;">, </span><span style="font-weight: 400;">chainId</span><span style="font-weight: 400;">:</span> <span style="font-weight: 400;">null</span><span style="font-weight: 400;"> };</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">// connect the wallet</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">async</span> <span style="font-weight: 400;">function</span> <span style="font-weight: 400;">connectWallet</span><span style="font-weight: 400;">() {</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">// get the provider, this time without ethereum object</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">let</span> <span style="font-weight: 400;">provider</span> <span style="font-weight: 400;">=</span> <span style="font-weight: 400;">new</span><span style="font-weight: 400;"> ethers.providers.</span><span style="font-weight: 400;">Web3Provider</span><span style="font-weight: 400;">(</span><span style="font-weight: 400;">window</span><span style="font-weight: 400;">.</span><span style="font-weight: 400;">ethereum</span><span style="font-weight: 400;">, </span><span style="font-weight: 400;">'any'</span><span style="font-weight: 400;">);</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">// prompt user for account connections</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">await</span> <span style="font-weight: 400;">provider</span><span style="font-weight: 400;">.</span><span style="font-weight: 400;">send</span><span style="font-weight: 400;">(</span><span style="font-weight: 400;">'eth_requestAccounts'</span><span style="font-weight: 400;">, []);</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">// get the signer</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">const</span> <span style="font-weight: 400;">signer</span> <span style="font-weight: 400;">=</span> <span style="font-weight: 400;">provider</span><span style="font-weight: 400;">.</span><span style="font-weight: 400;">getSigner</span><span style="font-weight: 400;">();</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">// get the account address</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">const</span> <span style="font-weight: 400;">account</span> <span style="font-weight: 400;">=</span> <span style="font-weight: 400;">await</span> <span style="font-weight: 400;">signer</span><span style="font-weight: 400;">.</span><span style="font-weight: 400;">getAddress</span><span style="font-weight: 400;">();</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">// get the chainId</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">const</span> <span style="font-weight: 400;">chainId</span> <span style="font-weight: 400;">=</span> <span style="font-weight: 400;">await</span> <span style="font-weight: 400;">signer</span><span style="font-weight: 400;">.</span><span style="font-weight: 400;">getChainId</span><span style="font-weight: 400;">();</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">// update the props</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">web3Props</span> <span style="font-weight: 400;">=</span><span style="font-weight: 400;"> { </span><span style="font-weight: 400;">signer</span><span style="font-weight: 400;">, </span><span style="font-weight: 400;">provider</span><span style="font-weight: 400;">, </span><span style="font-weight: 400;">chainId</span><span style="font-weight: 400;">, </span><span style="font-weight: 400;">account</span><span style="font-weight: 400;"> };</span>&#13; <span style="font-weight: 400;">    }</span>&#13; <span style="font-weight: 400;">&lt;/</span><span style="font-weight: 400;">script</span><span style="font-weight: 400;">&gt;</span>&#13; &#13; <span style="font-weight: 400;">&lt;</span><span style="font-weight: 400;">button</span> <span style="font-weight: 400;">on:click</span><span style="font-weight: 400;">=</span><span style="font-weight: 400;">{connectWallet}</span><span style="font-weight: 400;">&gt;Attach Wallet&lt;/</span><span style="font-weight: 400;">button</span><span style="font-weight: 400;">&gt;</span></pre> <p>组件更新后，你需要将 index.svelte 中的道具传递给组件。</p> <pre><span style="font-weight: 400;">svelte/src/routes/index.svelte</span>&#13; &#13; <span style="font-weight: 400;">&lt;</span><span style="font-weight: 400;">script</span><span style="font-weight: 400;">&gt;</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">import</span> <span style="font-weight: 400;">WalletConnect</span> <span style="font-weight: 400;">from</span> <span style="font-weight: 400;">'$lib/WalletConnect.svelte'</span><span style="font-weight: 400;">;</span>&#13; &#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">export</span> <span style="font-weight: 400;">let</span> <span style="font-weight: 400;">web3Props</span> <span style="font-weight: 400;">=</span><span style="font-weight: 400;"> {</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">provider</span><span style="font-weight: 400;">:</span> <span style="font-weight: 400;">null</span><span style="font-weight: 400;">,</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">signer</span><span style="font-weight: 400;">:</span> <span style="font-weight: 400;">null</span><span style="font-weight: 400;">,</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">account</span><span style="font-weight: 400;">:</span> <span style="font-weight: 400;">null</span><span style="font-weight: 400;">,</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">chainId</span><span style="font-weight: 400;">:</span> <span style="font-weight: 400;">null</span>&#13; <span style="font-weight: 400;">    };</span>&#13; <span style="font-weight: 400;">&lt;/</span><span style="font-weight: 400;">script</span><span style="font-weight: 400;">&gt;</span>&#13; &#13; <span style="font-weight: 400;">&lt;</span><span style="font-weight: 400;">h1</span><span style="font-weight: 400;">&gt;My Quiz&lt;/</span><span style="font-weight: 400;">h1</span><span style="font-weight: 400;">&gt;</span>&#13; <span style="font-weight: 400;">{#if !web3Props.account}</span>&#13; <span style="font-weight: 400;">    &lt;</span><span style="font-weight: 400;">WalletConnect</span> <span style="font-weight: 400;">bind:web3Props</span><span style="font-weight: 400;"> /&gt;</span>&#13; <span style="font-weight: 400;">{:else}</span>&#13; <span style="font-weight: 400;">    😎</span>&#13; <span style="font-weight: 400;">{/if}</span></pre> <p><img decoding="async" loading="lazy" class="alignnone wp-image-3945 size-full" src="../Images/a11355ce0db869a12d1d26ffa6c188b0.png" alt="Attach Wallet" width="800" height="744" data-original-src="https://blog.chain.link/wp-content/uploads/2022/06/unnamed.gif"/></p> <h2><span style="font-weight: 400;">创建测验</span></h2> <p>您已经连接了您的钱包！现在，您可以继续与测验工厂交互来创建问题。</p> <p>第一步是将两份合同的 ABI 带过来。当通过 Forge 为测试或部署编译合同时，会创建一个包含 ABI 的 JSON 版本的文件；</p> <p><span style="font-weight: 400;"> <code>out/QuizFactory.sol/QuizFactory.json</code> </span> <span style="font-weight: 400;">和</span> <span style="font-weight: 400;"> <code>out/QuizGame.sol/QuizGame.json</code> </span> <span style="font-weight: 400;">都是在铸造目录下创建的。在</span> <span style="font-weight: 400;"> <code>svelte/src</code> </span> <span style="font-weight: 400;">中新建一个目录，命名为</span> <span style="font-weight: 400;"> <code>contracts</code> </span> <span style="font-weight: 400;">，将两个文件复制到那里。这些将允许您与契约的已部署版本进行交互。</span></p> <p>一旦两个 JSON 文件都保存到新的合同目录中，您就可以创建一个组件来添加测验。</p> <pre><span style="font-weight: 400;">svelte/src/lib/AddQuestion.svelte</span>&#13; &#13; <span style="font-weight: 400;">&lt;</span><span style="font-weight: 400;">script</span><span style="font-weight: 400;">&gt;</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">// ethers allows you to interact with the Ethereum blockchain</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">import</span><span style="font-weight: 400;"> { </span><span style="font-weight: 400;">ethers</span><span style="font-weight: 400;"> } </span><span style="font-weight: 400;">from</span> <span style="font-weight: 400;">'ethers'</span><span style="font-weight: 400;">;</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">// web3Props holds the properties of the web3 provider</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">export</span> <span style="font-weight: 400;">let</span> <span style="font-weight: 400;">web3Props</span> <span style="font-weight: 400;">=</span><span style="font-weight: 400;"> {</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">provider</span><span style="font-weight: 400;">:</span> <span style="font-weight: 400;">null</span><span style="font-weight: 400;">,</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">signer</span><span style="font-weight: 400;">:</span> <span style="font-weight: 400;">null</span><span style="font-weight: 400;">,</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">account</span><span style="font-weight: 400;">:</span> <span style="font-weight: 400;">null</span><span style="font-weight: 400;">,</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">chainId</span><span style="font-weight: 400;">:</span> <span style="font-weight: 400;">null</span><span style="font-weight: 400;">,</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">contract</span><span style="font-weight: 400;">:</span> <span style="font-weight: 400;">null</span>&#13; <span style="font-weight: 400;">    };</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">// values for the quiz factory contract</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">$</span><span style="font-weight: 400;">:</span> <span style="font-weight: 400;">question</span> <span style="font-weight: 400;">=</span> <span style="font-weight: 400;">''</span><span style="font-weight: 400;">;</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">$</span><span style="font-weight: 400;">:</span> <span style="font-weight: 400;">answer</span> <span style="font-weight: 400;">=</span> <span style="font-weight: 400;">''</span><span style="font-weight: 400;">;</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">$</span><span style="font-weight: 400;">:</span> <span style="font-weight: 400;">encryptedAnswer</span> <span style="font-weight: 400;">=</span> <span style="font-weight: 400;">null</span><span style="font-weight: 400;">;</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">async</span> <span style="font-weight: 400;">function</span> <span style="font-weight: 400;">encryptAnswer</span><span style="font-weight: 400;">() {</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">// encrypt the answer using the same salt as the contract</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">encryptedAnswer</span> <span style="font-weight: 400;">=</span> <span style="font-weight: 400;">ethers</span><span style="font-weight: 400;">.</span><span style="font-weight: 400;">utils</span><span style="font-weight: 400;">.</span><span style="font-weight: 400;">keccak256</span><span style="font-weight: 400;">(</span>&#13; <span style="font-weight: 400;">            </span><span style="font-weight: 400;">ethers</span><span style="font-weight: 400;">.</span><span style="font-weight: 400;">utils</span><span style="font-weight: 400;">.</span><span style="font-weight: 400;">solidityPack</span><span style="font-weight: 400;">(</span>&#13; <span style="font-weight: 400;">                [</span><span style="font-weight: 400;">'bytes32'</span><span style="font-weight: 400;">, </span><span style="font-weight: 400;">'string'</span><span style="font-weight: 400;">],</span>&#13; <span style="font-weight: 400;">                [</span><span style="font-weight: 400;">ethers</span><span style="font-weight: 400;">.</span><span style="font-weight: 400;">utils</span><span style="font-weight: 400;">.</span><span style="font-weight: 400;">formatBytes32String</span><span style="font-weight: 400;">(</span><span style="font-weight: 400;">'123123123'</span><span style="font-weight: 400;">), </span><span style="font-weight: 400;">answer</span><span style="font-weight: 400;">]</span>&#13; <span style="font-weight: 400;">            )</span>&#13; <span style="font-weight: 400;">        );</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">// use the factory contract to create a new quiz</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">web3Props</span><span style="font-weight: 400;">.</span><span style="font-weight: 400;">contract</span><span style="font-weight: 400;">.</span><span style="font-weight: 400;">createQuiz</span><span style="font-weight: 400;">(</span><span style="font-weight: 400;">question</span><span style="font-weight: 400;">, </span><span style="font-weight: 400;">encryptedAnswer</span><span style="font-weight: 400;">);</span>&#13; <span style="font-weight: 400;">    }</span>&#13; <span style="font-weight: 400;">&lt;/</span><span style="font-weight: 400;">script</span><span style="font-weight: 400;">&gt;</span>&#13; &#13; <span style="font-weight: 400;">&lt;</span><span style="font-weight: 400;">div</span> <span style="font-weight: 400;">class</span><span style="font-weight: 400;">=</span><span style="font-weight: 400;">"wrapper"</span><span style="font-weight: 400;">&gt;</span>&#13; <span style="font-weight: 400;">    &lt;</span><span style="font-weight: 400;">span</span> <span style="font-weight: 400;">class</span><span style="font-weight: 400;">=</span><span style="font-weight: 400;">"input-label"</span><span style="font-weight: 400;">&gt; question: &lt;/</span><span style="font-weight: 400;">span</span><span style="font-weight: 400;">&gt;</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">&lt;!-- bind lets changes to question update the value of the variable  --&gt;</span>&#13; <span style="font-weight: 400;">    &lt;</span><span style="font-weight: 400;">input</span> <span style="font-weight: 400;">bind:value</span><span style="font-weight: 400;">=</span><span style="font-weight: 400;">{question}</span><span style="font-weight: 400;"> /&gt;</span>&#13; <span style="font-weight: 400;">    &lt;</span><span style="font-weight: 400;">br</span><span style="font-weight: 400;"> /&gt;</span>&#13; <span style="font-weight: 400;">    &lt;</span><span style="font-weight: 400;">span</span> <span style="font-weight: 400;">class</span><span style="font-weight: 400;">=</span><span style="font-weight: 400;">"input-label"</span><span style="font-weight: 400;">&gt; answer: &lt;/</span><span style="font-weight: 400;">span</span><span style="font-weight: 400;">&gt;</span>&#13; <span style="font-weight: 400;">    &lt;</span><span style="font-weight: 400;">input</span> <span style="font-weight: 400;">bind:value</span><span style="font-weight: 400;">=</span><span style="font-weight: 400;">{answer}</span><span style="font-weight: 400;"> /&gt;</span>&#13; <span style="font-weight: 400;">    &lt;</span><span style="font-weight: 400;">br</span><span style="font-weight: 400;"> /&gt;</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">&lt;!-- On click, run the encryptedAnswer function --&gt;</span>&#13; <span style="font-weight: 400;">    &lt;</span><span style="font-weight: 400;">button</span> <span style="font-weight: 400;">on:click</span><span style="font-weight: 400;">=</span><span style="font-weight: 400;">{encryptAnswer}</span><span style="font-weight: 400;">&gt; Add Question &lt;/</span><span style="font-weight: 400;">button</span><span style="font-weight: 400;">&gt;</span>&#13; <span style="font-weight: 400;">&lt;/</span><span style="font-weight: 400;">div</span><span style="font-weight: 400;">&gt;</span>&#13; <span style="font-weight: 400;">&#13; &lt;!-- Scoped CSS --&gt;</span>&#13; <span style="font-weight: 400;">&lt;</span><span style="font-weight: 400;">style</span><span style="font-weight: 400;">&gt;</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">.wrapper</span><span style="font-weight: 400;"> {</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">overflow</span><span style="font-weight: 400;">: </span><span style="font-weight: 400;">hidden</span><span style="font-weight: 400;">;</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">position</span><span style="font-weight: 400;">: </span><span style="font-weight: 400;">relative</span><span style="font-weight: 400;">;</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">margin-bottom</span><span style="font-weight: 400;">: </span><span style="font-weight: 400;">1</span><span style="font-weight: 400;">rem</span><span style="font-weight: 400;">;</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">padding</span><span style="font-weight: 400;">: </span><span style="font-weight: 400;">20</span><span style="font-weight: 400;">px</span><span style="font-weight: 400;">;</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">border-radius</span><span style="font-weight: 400;">: </span><span style="font-weight: 400;">15</span><span style="font-weight: 400;">px</span><span style="font-weight: 400;">;</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">width</span><span style="font-weight: 400;">: </span><span style="font-weight: 400;">33</span><span style="font-weight: 400;">%</span><span style="font-weight: 400;">;</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">box-shadow</span><span style="font-weight: 400;">: </span><span style="font-weight: 400;">1</span><span style="font-weight: 400;">px</span> <span style="font-weight: 400;">1</span><span style="font-weight: 400;">px</span> <span style="font-weight: 400;">4</span><span style="font-weight: 400;">px</span> <span style="font-weight: 400;">rgba</span><span style="font-weight: 400;">(</span><span style="font-weight: 400;">0, 0, 0, 0.3</span><span style="font-weight: 400;">);</span>&#13; <span style="font-weight: 400;">    }</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">.input-label</span><span style="font-weight: 400;"> {</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">display</span><span style="font-weight: 400;">: </span><span style="font-weight: 400;">inline-block</span><span style="font-weight: 400;">;</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">width</span><span style="font-weight: 400;">: </span><span style="font-weight: 400;">15</span><span style="font-weight: 400;">%</span><span style="font-weight: 400;">;</span>&#13; <span style="font-weight: 400;">    }</span>&#13; <span style="font-weight: 400;">&lt;/</span><span style="font-weight: 400;">style</span><span style="font-weight: 400;">&gt;</span></pre> <p><span style="font-weight: 400;">您需要确保您已经将该组件添加到了</span> <span style="font-weight: 400;"> <code>index.svelte</code> </span></p> <pre><span style="font-weight: 400;">svelte/src/routes/index.svelte</span>&#13; &#13; <span style="font-weight: 400;">&lt;</span><span style="font-weight: 400;">script</span><span style="font-weight: 400;">&gt;</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">import</span> <span style="font-weight: 400;">WalletConnect</span> <span style="font-weight: 400;">from</span> <span style="font-weight: 400;">'$lib/WalletConnect.svelte'</span><span style="font-weight: 400;">;</span>&#13; &#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">// NEW</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">import</span> <span style="font-weight: 400;">AddQuestion</span> <span style="font-weight: 400;">from</span> <span style="font-weight: 400;">'$lib/AddQuestion.svelte'</span><span style="font-weight: 400;">;</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">import</span> <span style="font-weight: 400;">contractAbi</span> <span style="font-weight: 400;">from</span> <span style="font-weight: 400;">'../contracts/QuizFactory.json'</span><span style="font-weight: 400;">;</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">const</span> <span style="font-weight: 400;">contractAddr</span> <span style="font-weight: 400;">=</span> <span style="font-weight: 400;">"&lt;YOUR CONTRACT ADDRESS HERE&gt;;</span>&#13; &#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">export</span> <span style="font-weight: 400;">let</span> <span style="font-weight: 400;">web3Props</span> <span style="font-weight: 400;">=</span><span style="font-weight: 400;"> {</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">provider</span><span style="font-weight: 400;">:</span> <span style="font-weight: 400;">null</span><span style="font-weight: 400;">,</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">signer</span><span style="font-weight: 400;">:</span> <span style="font-weight: 400;">null</span><span style="font-weight: 400;">,</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">account</span><span style="font-weight: 400;">:</span> <span style="font-weight: 400;">null</span><span style="font-weight: 400;">,</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">chainId</span><span style="font-weight: 400;">:</span> <span style="font-weight: 400;">null</span>&#13; <span style="font-weight: 400;">    };</span>&#13; <span style="font-weight: 400;">&lt;/</span><span style="font-weight: 400;">script</span><span style="font-weight: 400;">&gt;</span>&#13; &#13; <span style="font-weight: 400;">&lt;</span><span style="font-weight: 400;">h1</span><span style="font-weight: 400;">&gt;My Quiz&lt;/</span><span style="font-weight: 400;">h1</span><span style="font-weight: 400;">&gt;</span>&#13; <span style="font-weight: 400;">{#if !web3Props.account}</span>&#13; <span style="font-weight: 400;">    &lt;</span><span style="font-weight: 400;">WalletConnect</span> <span style="font-weight: 400;">bind:web3Props</span><span style="font-weight: 400;"> /&gt;</span>&#13; <span style="font-weight: 400;">{:else}</span>&#13; <span style="font-weight: 400;">&lt;!-- NEW --&gt;</span>&#13; <span style="font-weight: 400;">    &lt;</span><span style="font-weight: 400;">AddQuestion</span><span style="font-weight: 400;"> {</span><span style="font-weight: 400;">web3Props</span><span style="font-weight: 400;">} /&gt;</span>&#13; <span style="font-weight: 400;">{/if}</span></pre> <p><b>请注意:</b> <span style="font-weight: 400;">您需要上面“合同完成”部分记录的合同地址。这将是</span> <span style="font-weight: 400;"> <code>contractAddr</code> </span> <span style="font-weight: 400;">的值。</span></p> <p><span style="font-weight: 400;">将新值添加到</span> <span style="font-weight: 400;"> <code>index.svelte</code> </span>中的 WalletConnect 组件</p> <pre><span style="font-weight: 400;">&lt;</span><span style="font-weight: 400;">WalletConnect</span> <span style="font-weight: 400;">bind:web3Props</span><span style="font-weight: 400;"> {</span><span style="font-weight: 400;">contractAddr</span><span style="font-weight: 400;">} {</span><span style="font-weight: 400;">contractAbi</span><span style="font-weight: 400;">} /&gt;</span></pre> <p><span style="font-weight: 400;">将它们添加到组件本身。</span></p> <pre><span style="font-weight: 400;">svelte/src/lib/WalletConnect.svelte</span>&#13; &#13; <span style="font-weight: 400;">&lt;</span><span style="font-weight: 400;">script</span><span style="font-weight: 400;">&gt;</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">import</span><span style="font-weight: 400;"> { </span><span style="font-weight: 400;">ethers</span><span style="font-weight: 400;"> } </span><span style="font-weight: 400;">from</span> <span style="font-weight: 400;">'ethers'</span><span style="font-weight: 400;">;</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">export</span> <span style="font-weight: 400;">let</span> <span style="font-weight: 400;">web3Props</span> <span style="font-weight: 400;">=</span><span style="font-weight: 400;"> {</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">provider</span><span style="font-weight: 400;">:</span> <span style="font-weight: 400;">null</span><span style="font-weight: 400;">,</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">signer</span><span style="font-weight: 400;">:</span> <span style="font-weight: 400;">null</span><span style="font-weight: 400;">,</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">account</span><span style="font-weight: 400;">:</span> <span style="font-weight: 400;">null</span><span style="font-weight: 400;">,</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">chainId</span><span style="font-weight: 400;">:</span> <span style="font-weight: 400;">null</span><span style="font-weight: 400;">,</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">// new prop</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">contract</span><span style="font-weight: 400;">:</span> <span style="font-weight: 400;">null</span>&#13; <span style="font-weight: 400;">    };</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">// new variable for the contract address</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">export</span> <span style="font-weight: 400;">let</span> <span style="font-weight: 400;">contractAddr</span> <span style="font-weight: 400;">=</span> <span style="font-weight: 400;">''</span><span style="font-weight: 400;">;</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">// new variable for the contract ABI</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">export</span> <span style="font-weight: 400;">let</span> <span style="font-weight: 400;">contractAbi</span> <span style="font-weight: 400;">=</span><span style="font-weight: 400;"> { </span><span style="font-weight: 400;">abi</span><span style="font-weight: 400;">:</span> <span style="font-weight: 400;">null</span><span style="font-weight: 400;"> };</span>&#13; &#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">async</span> <span style="font-weight: 400;">function</span> <span style="font-weight: 400;">connectWallet</span><span style="font-weight: 400;">() {</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">let</span> <span style="font-weight: 400;">provider</span> <span style="font-weight: 400;">=</span> <span style="font-weight: 400;">new</span><span style="font-weight: 400;"> ethers.providers.</span><span style="font-weight: 400;">Web3Provider</span><span style="font-weight: 400;">(</span><span style="font-weight: 400;">window</span><span style="font-weight: 400;">.</span><span style="font-weight: 400;">ethereum</span><span style="font-weight: 400;">, </span><span style="font-weight: 400;">'any'</span><span style="font-weight: 400;">);</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">await</span> <span style="font-weight: 400;">provider</span><span style="font-weight: 400;">.</span><span style="font-weight: 400;">send</span><span style="font-weight: 400;">(</span><span style="font-weight: 400;">'eth_requestAccounts'</span><span style="font-weight: 400;">, []);</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">const</span> <span style="font-weight: 400;">signer</span> <span style="font-weight: 400;">=</span> <span style="font-weight: 400;">provider</span><span style="font-weight: 400;">.</span><span style="font-weight: 400;">getSigner</span><span style="font-weight: 400;">();</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">const</span> <span style="font-weight: 400;">account</span> <span style="font-weight: 400;">=</span> <span style="font-weight: 400;">await</span> <span style="font-weight: 400;">signer</span><span style="font-weight: 400;">.</span><span style="font-weight: 400;">getAddress</span><span style="font-weight: 400;">();</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">const</span> <span style="font-weight: 400;">chainId</span> <span style="font-weight: 400;">=</span> <span style="font-weight: 400;">await</span> <span style="font-weight: 400;">signer</span><span style="font-weight: 400;">.</span><span style="font-weight: 400;">getChainId</span><span style="font-weight: 400;">();</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">// new contract variable</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">const</span> <span style="font-weight: 400;">contract</span> <span style="font-weight: 400;">=</span> <span style="font-weight: 400;">new</span><span style="font-weight: 400;"> ethers.</span><span style="font-weight: 400;">Contract</span><span style="font-weight: 400;">(</span><span style="font-weight: 400;">contractAddr</span><span style="font-weight: 400;">, </span><span style="font-weight: 400;">contractAbi</span><span style="font-weight: 400;">.</span><span style="font-weight: 400;">abi</span><span style="font-weight: 400;">, </span><span style="font-weight: 400;">signer</span><span style="font-weight: 400;">);</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">// new value for contract</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">web3Props</span> <span style="font-weight: 400;">=</span><span style="font-weight: 400;"> { </span><span style="font-weight: 400;">signer</span><span style="font-weight: 400;">, </span><span style="font-weight: 400;">provider</span><span style="font-weight: 400;">, </span><span style="font-weight: 400;">chainId</span><span style="font-weight: 400;">, </span><span style="font-weight: 400;">account</span><span style="font-weight: 400;">, </span><span style="font-weight: 400;">contract</span><span style="font-weight: 400;"> };</span>&#13; <span style="font-weight: 400;">    }</span>&#13; <span style="font-weight: 400;">&lt;/</span><span style="font-weight: 400;">script</span><span style="font-weight: 400;">&gt;</span>&#13; <span style="font-weight: 400;">&#13; &lt;</span><span style="font-weight: 400;">button</span> <span style="font-weight: 400;">on:click</span><span style="font-weight: 400;">=</span><span style="font-weight: 400;">{connectWallet}</span><span style="font-weight: 400;">&gt;Attach Wallet&lt;/</span><span style="font-weight: 400;">button</span><span style="font-weight: 400;">&gt;</span></pre> <h2><span style="font-weight: 400;">显示一个问题</span></h2> <p><span style="font-weight: 400;">继续补充一个问题。这将使用</span> <span style="font-weight: 400;"> <code>quizFactory</code> </span> <span style="font-weight: 400;">契约创建一个新的</span> <span style="font-weight: 400;"> <code>quizGame</code> </span> <span style="font-weight: 400;">。一旦你确认了交易，就可以看到测试了。您需要构建一个问题组件。该组件将显示一个问题。您将重用这个组件来显示所有的问题。</span></p> <pre><span style="font-weight: 400;">svelte/src/lib/Question.svelte</span>&#13; &#13; <span style="font-weight: 400;">&lt;</span><span style="font-weight: 400;">script</span><span style="font-weight: 400;">&gt;</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">import</span><span style="font-weight: 400;"> { </span><span style="font-weight: 400;">ethers</span><span style="font-weight: 400;"> } </span><span style="font-weight: 400;">from</span> <span style="font-weight: 400;">'ethers'</span><span style="font-weight: 400;">;</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">// import the single quiz game contract</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">import</span> <span style="font-weight: 400;">contractAbi</span> <span style="font-weight: 400;">from</span> <span style="font-weight: 400;">'../contracts/QuizGame.json'</span><span style="font-weight: 400;">;</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">// place holders for variables</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">let</span> <span style="font-weight: 400;">answer</span> <span style="font-weight: 400;">=</span> <span style="font-weight: 400;">null</span><span style="font-weight: 400;">;</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">let</span> <span style="font-weight: 400;">funding</span> <span style="font-weight: 400;">=</span> <span style="font-weight: 400;">null</span><span style="font-weight: 400;">;</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">export</span> <span style="font-weight: 400;">let</span> <span style="font-weight: 400;">web3Props</span> <span style="font-weight: 400;">=</span><span style="font-weight: 400;"> {</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">provider</span><span style="font-weight: 400;">:</span> <span style="font-weight: 400;">null</span><span style="font-weight: 400;">,</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">signer</span><span style="font-weight: 400;">:</span> <span style="font-weight: 400;">null</span><span style="font-weight: 400;">,</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">account</span><span style="font-weight: 400;">:</span> <span style="font-weight: 400;">null</span><span style="font-weight: 400;">,</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">chainId</span><span style="font-weight: 400;">:</span> <span style="font-weight: 400;">null</span><span style="font-weight: 400;">,</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">contract</span><span style="font-weight: 400;">:</span> <span style="font-weight: 400;">null</span>&#13; <span style="font-weight: 400;">    };</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">export</span> <span style="font-weight: 400;">let</span> <span style="font-weight: 400;">questionAddr</span> <span style="font-weight: 400;">=</span> <span style="font-weight: 400;">null</span><span style="font-weight: 400;">;</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">$</span><span style="font-weight: 400;">:</span> <span style="font-weight: 400;">question</span> <span style="font-weight: 400;">=</span> <span style="font-weight: 400;">null</span><span style="font-weight: 400;">;</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">$</span><span style="font-weight: 400;">:</span> <span style="font-weight: 400;">value</span> <span style="font-weight: 400;">=</span> <span style="font-weight: 400;">null</span><span style="font-weight: 400;">;</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">// funded will determine what CSS and functionality is available</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">$</span><span style="font-weight: 400;">:</span> <span style="font-weight: 400;">funded</span> <span style="font-weight: 400;">=</span> <span style="font-weight: 400;">value</span> <span style="font-weight: 400;">&gt;</span> <span style="font-weight: 400;">0</span> <span style="font-weight: 400;">?</span> <span style="font-weight: 400;">'question-funded'</span><span style="font-weight: 400;"> : </span><span style="font-weight: 400;">'question-not-funded'</span><span style="font-weight: 400;">;</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">let</span> <span style="font-weight: 400;">qContract</span> <span style="font-weight: 400;">=</span> <span style="font-weight: 400;">null</span><span style="font-weight: 400;">;</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">async</span> <span style="font-weight: 400;">function</span> <span style="font-weight: 400;">getQuestion</span><span style="font-weight: 400;">() {</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">// get the question contract</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">qContract</span> <span style="font-weight: 400;">=</span> <span style="font-weight: 400;">new</span><span style="font-weight: 400;"> ethers.</span><span style="font-weight: 400;">Contract</span><span style="font-weight: 400;">(</span><span style="font-weight: 400;">questionAddr</span><span style="font-weight: 400;">, </span><span style="font-weight: 400;">contractAbi</span><span style="font-weight: 400;">.</span><span style="font-weight: 400;">abi</span><span style="font-weight: 400;">, </span><span style="font-weight: 400;">web3Props</span><span style="font-weight: 400;">.</span><span style="font-weight: 400;">signer</span><span style="font-weight: 400;">);</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">// get the question</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">question</span> <span style="font-weight: 400;">=</span> <span style="font-weight: 400;">await</span> <span style="font-weight: 400;">qContract</span><span style="font-weight: 400;">.</span><span style="font-weight: 400;">question</span><span style="font-weight: 400;">();</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">// get the value of a correct answer</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">value</span> <span style="font-weight: 400;">=</span> <span style="font-weight: 400;">Number</span><span style="font-weight: 400;">(</span><span style="font-weight: 400;">ethers</span><span style="font-weight: 400;">.</span><span style="font-weight: 400;">utils</span><span style="font-weight: 400;">.</span><span style="font-weight: 400;">formatEther</span><span style="font-weight: 400;">(</span><span style="font-weight: 400;">await</span> <span style="font-weight: 400;">web3Props</span><span style="font-weight: 400;">.</span><span style="font-weight: 400;">provider</span><span style="font-weight: 400;">.</span><span style="font-weight: 400;">getBalance</span><span style="font-weight: 400;">(</span><span style="font-weight: 400;">questionAddr</span><span style="font-weight: 400;">)));</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">// listen for funding</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">qContract</span><span style="font-weight: 400;">.</span><span style="font-weight: 400;">on</span><span style="font-weight: 400;">(</span><span style="font-weight: 400;">'QuizFunded'</span><span style="font-weight: 400;">, (</span><span style="font-weight: 400;">balance</span><span style="font-weight: 400;">) </span><span style="font-weight: 400;">=&gt;</span><span style="font-weight: 400;"> {</span>&#13; <span style="font-weight: 400;">            </span><span style="font-weight: 400;">console</span><span style="font-weight: 400;">.</span><span style="font-weight: 400;">log</span><span style="font-weight: 400;">(</span><span style="font-weight: 400;">'QuizFunded'</span><span style="font-weight: 400;">, </span><span style="font-weight: 400;">balance</span><span style="font-weight: 400;">);</span>&#13; <span style="font-weight: 400;">            </span><span style="font-weight: 400;">value</span> <span style="font-weight: 400;">=</span> <span style="font-weight: 400;">Number</span><span style="font-weight: 400;">(</span><span style="font-weight: 400;">ethers</span><span style="font-weight: 400;">.</span><span style="font-weight: 400;">utils</span><span style="font-weight: 400;">.</span><span style="font-weight: 400;">formatEther</span><span style="font-weight: 400;">(</span><span style="font-weight: 400;">balance</span><span style="font-weight: 400;">));</span>&#13; <span style="font-weight: 400;">        });</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">// listen for correct answers</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">qContract</span><span style="font-weight: 400;">.</span><span style="font-weight: 400;">on</span><span style="font-weight: 400;">(</span><span style="font-weight: 400;">'AnswerGuessed'</span><span style="font-weight: 400;">, () </span><span style="font-weight: 400;">=&gt;</span><span style="font-weight: 400;"> {</span>&#13; <span style="font-weight: 400;">            </span><span style="font-weight: 400;">getQuestion</span><span style="font-weight: 400;">();</span>&#13; <span style="font-weight: 400;">        });</span>&#13; <span style="font-weight: 400;">    }</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">// submit a guess to the contract</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">async</span> <span style="font-weight: 400;">function</span> <span style="font-weight: 400;">submitGuess</span><span style="font-weight: 400;">() {</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">await</span> <span style="font-weight: 400;">qContract</span><span style="font-weight: 400;">.</span><span style="font-weight: 400;">guess</span><span style="font-weight: 400;">(</span><span style="font-weight: 400;">answer</span><span style="font-weight: 400;">);</span>&#13; <span style="font-weight: 400;">    }</span>&#13; <span style="font-weight: 400;">   </span><span style="font-weight: 400;">// fund the quesiton</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">async</span> <span style="font-weight: 400;">function</span> <span style="font-weight: 400;">fund</span><span style="font-weight: 400;">() {</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">web3Props</span><span style="font-weight: 400;">.</span><span style="font-weight: 400;">signer</span><span style="font-weight: 400;">.</span><span style="font-weight: 400;">sendTransaction</span><span style="font-weight: 400;">({</span>&#13; <span style="font-weight: 400;">            </span><span style="font-weight: 400;">to</span><span style="font-weight: 400;">:</span> <span style="font-weight: 400;">questionAddr</span><span style="font-weight: 400;">,</span>&#13; <span style="font-weight: 400;">           </span><span style="font-weight: 400;">value</span><span style="font-weight: 400;">:</span> <span style="font-weight: 400;">ethers</span><span style="font-weight: 400;">.</span><span style="font-weight: 400;">utils</span><span style="font-weight: 400;">.</span><span style="font-weight: 400;">parseEther</span><span style="font-weight: 400;">(</span><span style="font-weight: 400;">funding</span><span style="font-weight: 400;">)</span>&#13; <span style="font-weight: 400;">        });</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">funding</span> <span style="font-weight: 400;">=</span> <span style="font-weight: 400;">null</span><span style="font-weight: 400;">;</span>&#13; <span style="font-weight: 400;">    }</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">// run the getQuestion function</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">getQuestion</span><span style="font-weight: 400;">();</span>&#13; <span style="font-weight: 400;">&lt;/</span><span style="font-weight: 400;">script</span><span style="font-weight: 400;">&gt;</span>&#13; &#13; <span style="font-weight: 400;">&lt;!-- Based on the funding change the CSS class --&gt;</span>&#13; <span style="font-weight: 400;">&lt;</span><span style="font-weight: 400;">div</span> <span style="font-weight: 400;">class</span><span style="font-weight: 400;">=</span><span style="font-weight: 400;">"{funded} qwrap"</span><span style="font-weight: 400;">&gt;</span>&#13; <span style="font-weight: 400;">    &lt;</span><span style="font-weight: 400;">div</span> <span style="font-weight: 400;">class</span><span style="font-weight: 400;">=</span><span style="font-weight: 400;">"question"</span><span style="font-weight: 400;">&gt;</span>&#13; <span style="font-weight: 400;">        {question}</span>&#13; <span style="font-weight: 400;">    &lt;/</span><span style="font-weight: 400;">div</span><span style="font-weight: 400;">&gt;</span>&#13; <span style="font-weight: 400;">    &lt;</span><span style="font-weight: 400;">div</span> <span style="font-weight: 400;">class</span><span style="font-weight: 400;">=</span><span style="font-weight: 400;">"value"</span><span style="font-weight: 400;">&gt;</span>&#13; <span style="font-weight: 400;">        {value} ETH</span>&#13; <span style="font-weight: 400;">    &lt;/</span><span style="font-weight: 400;">div</span><span style="font-weight: 400;">&gt;</span>&#13; <span style="font-weight: 400;">    &lt;</span><span style="font-weight: 400;">input</span> <span style="font-weight: 400;">type</span><span style="font-weight: 400;">=</span><span style="font-weight: 400;">"text"</span> <span style="font-weight: 400;">bind:value</span><span style="font-weight: 400;">=</span><span style="font-weight: 400;">{answer}</span><span style="font-weight: 400;"> /&gt;</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">&lt;!-- If the question has no value, disable it --&gt;</span>&#13; <span style="font-weight: 400;">    &lt;</span><span style="font-weight: 400;">button</span> <span style="font-weight: 400;">on:click</span><span style="font-weight: 400;">=</span><span style="font-weight: 400;">{submitGuess}</span> <span style="font-weight: 400;">disabled</span><span style="font-weight: 400;">=</span><span style="font-weight: 400;">{value</span><span style="font-weight: 400;"> &lt;= </span><span style="font-weight: 400;">0</span><span style="font-weight: 400;">}&gt;Submit Answer&lt;/</span><span style="font-weight: 400;">button</span><span style="font-weight: 400;">&gt;</span>&#13; <span style="font-weight: 400;">    &lt;</span><span style="font-weight: 400;">br</span><span style="font-weight: 400;"> /&gt;</span>&#13; <span style="font-weight: 400;">    &lt;</span><span style="font-weight: 400;">input</span> <span style="font-weight: 400;">type</span><span style="font-weight: 400;">=</span><span style="font-weight: 400;">"text"</span> <span style="font-weight: 400;">bind:value</span><span style="font-weight: 400;">=</span><span style="font-weight: 400;">{funding}</span><span style="font-weight: 400;"> /&gt;</span>&#13; <span style="font-weight: 400;">    &lt;</span><span style="font-weight: 400;">button</span> <span style="font-weight: 400;">on:click</span><span style="font-weight: 400;">=</span><span style="font-weight: 400;">{fund}</span><span style="font-weight: 400;">&gt;Fund&lt;/</span><span style="font-weight: 400;">button</span><span style="font-weight: 400;">&gt;</span>&#13; <span style="font-weight: 400;">&lt;/</span><span style="font-weight: 400;">div</span><span style="font-weight: 400;">&gt;</span>&#13; &#13; <span style="font-weight: 400;">&lt;</span><span style="font-weight: 400;">style</span><span style="font-weight: 400;">&gt;</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">.question-funded</span><span style="font-weight: 400;"> {</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">background</span><span style="font-weight: 400;">: </span><span style="font-weight: 400;">#4ee44e</span><span style="font-weight: 400;">;</span>&#13; <span style="font-weight: 400;">    }</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">.question-not-funded</span><span style="font-weight: 400;"> {</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">background</span><span style="font-weight: 400;">: </span><span style="font-weight: 400;">#ffb6c1</span><span style="font-weight: 400;">;</span>&#13; <span style="font-weight: 400;">    }</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">.qwrap</span><span style="font-weight: 400;"> {</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">overflow</span><span style="font-weight: 400;">: </span><span style="font-weight: 400;">hidden</span><span style="font-weight: 400;">;</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">position</span><span style="font-weight: 400;">: </span><span style="font-weight: 400;">relative</span><span style="font-weight: 400;">;</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">color</span><span style="font-weight: 400;">: </span><span style="font-weight: 400;">white</span><span style="font-weight: 400;">;</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">margin-bottom</span><span style="font-weight: 400;">: </span><span style="font-weight: 400;">1</span><span style="font-weight: 400;">rem</span><span style="font-weight: 400;">;</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">padding</span><span style="font-weight: 400;">: </span><span style="font-weight: 400;">20</span><span style="font-weight: 400;">px</span><span style="font-weight: 400;">;</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">border-radius</span><span style="font-weight: 400;">: </span><span style="font-weight: 400;">15</span><span style="font-weight: 400;">px</span><span style="font-weight: 400;">;</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">width</span><span style="font-weight: 400;">: </span><span style="font-weight: 400;">50</span><span style="font-weight: 400;">%</span><span style="font-weight: 400;">;</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">box-shadow</span><span style="font-weight: 400;">: </span><span style="font-weight: 400;">1</span><span style="font-weight: 400;">px</span> <span style="font-weight: 400;">1</span><span style="font-weight: 400;">px</span> <span style="font-weight: 400;">4</span><span style="font-weight: 400;">px</span> <span style="font-weight: 400;">rgba</span><span style="font-weight: 400;">(</span><span style="font-weight: 400;">0, 0, 0, 0.3</span><span style="font-weight: 400;">);</span>&#13; <span style="font-weight: 400;">    }</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">.question</span><span style="font-weight: 400;"> {</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">font-size</span><span style="font-weight: 400;">: </span><span style="font-weight: 400;">2</span><span style="font-weight: 400;">em</span><span style="font-weight: 400;">;</span>&#13; <span style="font-weight: 400;">    }</span>&#13; <span style="font-weight: 400;">&lt;/</span><span style="font-weight: 400;">style</span><span style="font-weight: 400;">&gt;</span></pre> <p>将您的新组件添加到 index.svelte </p> <pre><span style="font-weight: 400;">svelte/src/routes/index.svelte</span>&#13; &#13; <span style="font-weight: 400;">&lt;</span><span style="font-weight: 400;">script</span><span style="font-weight: 400;">&gt;</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">import</span> <span style="font-weight: 400;">WalletConnect</span> <span style="font-weight: 400;">from</span> <span style="font-weight: 400;">'$lib/WalletConnect.svelte'</span><span style="font-weight: 400;">;</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">import</span> <span style="font-weight: 400;">AddQuestion</span> <span style="font-weight: 400;">from</span> <span style="font-weight: 400;">'$lib/AddQuestion.svelte'</span><span style="font-weight: 400;">;</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">import</span> <span style="font-weight: 400;">contractAbi</span> <span style="font-weight: 400;">from</span> <span style="font-weight: 400;">'../contracts/QuizFactory.json'</span><span style="font-weight: 400;">;</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">// NEW</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">import</span> <span style="font-weight: 400;">Question</span> <span style="font-weight: 400;">from</span> <span style="font-weight: 400;">'$lib/Question.svelte'</span><span style="font-weight: 400;">;</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">const</span> <span style="font-weight: 400;">contractAddr</span> <span style="font-weight: 400;">=</span> <span style="font-weight: 400;">'0xe7608e790a0ac33014fdeaef9c8bf0c37bf443f0'</span><span style="font-weight: 400;">;</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">export</span> <span style="font-weight: 400;">let</span> <span style="font-weight: 400;">web3Props</span> <span style="font-weight: 400;">=</span><span style="font-weight: 400;"> {</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">provider</span><span style="font-weight: 400;">:</span> <span style="font-weight: 400;">null</span><span style="font-weight: 400;">,</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">signer</span><span style="font-weight: 400;">:</span> <span style="font-weight: 400;">null</span><span style="font-weight: 400;">,</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">account</span><span style="font-weight: 400;">:</span> <span style="font-weight: 400;">null</span><span style="font-weight: 400;">,</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">chainId</span><span style="font-weight: 400;">:</span> <span style="font-weight: 400;">null</span>&#13; <span style="font-weight: 400;">    };</span>&#13; <span style="font-weight: 400;">&lt;/</span><span style="font-weight: 400;">script</span><span style="font-weight: 400;">&gt;</span>&#13; &#13; <span style="font-weight: 400;">&lt;</span><span style="font-weight: 400;">h1</span><span style="font-weight: 400;">&gt;My Quiz&lt;/</span><span style="font-weight: 400;">h1</span><span style="font-weight: 400;">&gt;</span>&#13; <span style="font-weight: 400;">{#if !web3Props.account}</span>&#13; <span style="font-weight: 400;">    &lt;</span><span style="font-weight: 400;">WalletConnect</span> <span style="font-weight: 400;">bind:web3Props</span><span style="font-weight: 400;"> {</span><span style="font-weight: 400;">contractAddr</span><span style="font-weight: 400;">} {</span><span style="font-weight: 400;">contractAbi</span><span style="font-weight: 400;">} /&gt;</span>&#13; <span style="font-weight: 400;">{:else}</span>&#13; <span style="font-weight: 400;">    &lt;</span><span style="font-weight: 400;">AddQuestion</span><span style="font-weight: 400;"> {</span><span style="font-weight: 400;">web3Props</span><span style="font-weight: 400;">} /&gt;</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">&lt;!-- NEW --&gt;</span>&#13; <span style="font-weight: 400;">    &lt;</span><span style="font-weight: 400;">Question</span><span style="font-weight: 400;"> {</span><span style="font-weight: 400;">web3Props</span><span style="font-weight: 400;">} /&gt;</span>&#13; <span style="font-weight: 400;">{/if}</span></pre> <p><span style="font-weight: 400;">此时，您应该看到以下内容。</span></p> <p><img decoding="async" loading="lazy" class="alignnone wp-image-3946 size-full" src="../Images/651ce2948a5fc7014c6e437fc3fe7a9d.png" alt="null ETH" width="1550" height="336" srcset="https://blog.chain.link/wp-content/uploads/2022/06/unnamed-2.png 1550w, https://blog.chain.link/wp-content/uploads/2022/06/unnamed-2-300x65.png 300w, https://blog.chain.link/wp-content/uploads/2022/06/unnamed-2-1024x222.png 1024w, https://blog.chain.link/wp-content/uploads/2022/06/unnamed-2-768x166.png 768w, https://blog.chain.link/wp-content/uploads/2022/06/unnamed-2-1536x333.png 1536w, https://blog.chain.link/wp-content/uploads/2022/06/unnamed-2-24x5.png 24w, https://blog.chain.link/wp-content/uploads/2022/06/unnamed-2-36x8.png 36w, https://blog.chain.link/wp-content/uploads/2022/06/unnamed-2-48x10.png 48w" sizes="(max-width: 1550px) 100vw, 1550px" data-original-src="https://blog.chain.link/wp-content/uploads/2022/06/unnamed-2.png"/></p> <p>这是因为没有传入合同地址。如果你愿意，你可以传入地址，或者继续获取所有的测验。</p> <h2><span style="font-weight: 400;">所有测验问题</span></h2> <p>祝贺你，你已经到达了最后一步！</p> <p><span style="font-weight: 400;">一旦你有了一个单独的测验组件，你可以恢复你对</span> <span style="font-weight: 400;"> <code>index.svelte</code> </span> <span style="font-weight: 400;">所做的更改。您将添加一个新组件:</span> <span style="font-weight: 400;"> <code>AllQuestions</code> </span> <span style="font-weight: 400;">。继续创建它。</span></p> <pre><span style="font-weight: 400;">svelte/src/lib/AllQustions.svelte</span>&#13; &#13; <span style="font-weight: 400;">&lt;</span><span style="font-weight: 400;">script</span><span style="font-weight: 400;">&gt;</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">// import your question component</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">import</span> <span style="font-weight: 400;">Question</span> <span style="font-weight: 400;">from</span> <span style="font-weight: 400;">'./Question.svelte'</span><span style="font-weight: 400;">;</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">// variables for the contract</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">export</span> <span style="font-weight: 400;">let</span> <span style="font-weight: 400;">web3Props</span> <span style="font-weight: 400;">=</span><span style="font-weight: 400;"> {</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">provider</span><span style="font-weight: 400;">:</span> <span style="font-weight: 400;">null</span><span style="font-weight: 400;">,</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">signer</span><span style="font-weight: 400;">:</span> <span style="font-weight: 400;">null</span><span style="font-weight: 400;">,</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">account</span><span style="font-weight: 400;">:</span> <span style="font-weight: 400;">null</span><span style="font-weight: 400;">,</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">chainId</span><span style="font-weight: 400;">:</span> <span style="font-weight: 400;">null</span><span style="font-weight: 400;">,</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">contract</span><span style="font-weight: 400;">:</span> <span style="font-weight: 400;">null</span>&#13; <span style="font-weight: 400;">    };</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">$</span><span style="font-weight: 400;">:</span> <span style="font-weight: 400;">questions</span> <span style="font-weight: 400;">=</span> <span style="font-weight: 400;">null</span><span style="font-weight: 400;">;</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">// get ALL of the questions</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">async</span> <span style="font-weight: 400;">function</span> <span style="font-weight: 400;">getQuestions</span><span style="font-weight: 400;">() {</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">questions</span> <span style="font-weight: 400;">=</span> <span style="font-weight: 400;">await</span> <span style="font-weight: 400;">web3Props</span><span style="font-weight: 400;">.</span><span style="font-weight: 400;">contract</span><span style="font-weight: 400;">.</span><span style="font-weight: 400;">getQuizes</span><span style="font-weight: 400;">();</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">// listen for new questions</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">web3Props</span><span style="font-weight: 400;">.</span><span style="font-weight: 400;">contract</span><span style="font-weight: 400;">.</span><span style="font-weight: 400;">on</span><span style="font-weight: 400;">(</span><span style="font-weight: 400;">'QuizCreated'</span><span style="font-weight: 400;">, (</span><span style="font-weight: 400;">addr</span><span style="font-weight: 400;">) </span><span style="font-weight: 400;">=&gt;</span><span style="font-weight: 400;"> {</span>&#13; <span style="font-weight: 400;">            </span><span style="font-weight: 400;">console</span><span style="font-weight: 400;">.</span><span style="font-weight: 400;">log</span><span style="font-weight: 400;">(</span><span style="font-weight: 400;">'QuizCreated'</span><span style="font-weight: 400;">, </span><span style="font-weight: 400;">addr</span><span style="font-weight: 400;">);</span>&#13; <span style="font-weight: 400;">            </span><span style="font-weight: 400;">getQuestions</span><span style="font-weight: 400;">();</span>&#13; <span style="font-weight: 400;">        });</span>&#13; <span style="font-weight: 400;">    }</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">getQuestions</span><span style="font-weight: 400;">();</span>&#13; <span style="font-weight: 400;">&lt;/</span><span style="font-weight: 400;">script</span><span style="font-weight: 400;">&gt;</span>&#13; &#13; <span style="font-weight: 400;">&lt;!-- If there are questions --&gt;</span>&#13; <span style="font-weight: 400;">{#if questions}</span>&#13; <span style="font-weight: 400;">    &lt;</span><span style="font-weight: 400;">div</span> <span style="font-weight: 400;">class</span><span style="font-weight: 400;">=</span><span style="font-weight: 400;">"question-wrapper"</span><span style="font-weight: 400;">&gt;</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">&lt;!-- Loop through the questions --&gt;</span>&#13; <span style="font-weight: 400;">        {#each questions as questionAddr}</span>&#13; <span style="font-weight: 400;">            </span><span style="font-weight: 400;">&lt;!-- Render the question component --&gt;</span>&#13; <span style="font-weight: 400;">            &lt;</span><span style="font-weight: 400;">Question</span><span style="font-weight: 400;"> {</span><span style="font-weight: 400;">questionAddr</span><span style="font-weight: 400;">} {</span><span style="font-weight: 400;">web3Props</span><span style="font-weight: 400;">} /&gt;</span>&#13; <span style="font-weight: 400;">        {/each}</span>&#13; <span style="font-weight: 400;">    &lt;/</span><span style="font-weight: 400;">div</span><span style="font-weight: 400;">&gt;</span>&#13; <span style="font-weight: 400;">{/if}</span>&#13; &#13; <span style="font-weight: 400;">&lt;</span><span style="font-weight: 400;">style</span><span style="font-weight: 400;">&gt;</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">.question-wrapper</span><span style="font-weight: 400;"> {</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">display</span><span style="font-weight: 400;">: flex;</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">flex-direction</span><span style="font-weight: 400;">: </span><span style="font-weight: 400;">column</span><span style="font-weight: 400;">;</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">justify-content</span><span style="font-weight: 400;">: </span><span style="font-weight: 400;">center</span><span style="font-weight: 400;">;</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">align-items</span><span style="font-weight: 400;">: </span><span style="font-weight: 400;">center</span><span style="font-weight: 400;">;</span>&#13; <span style="font-weight: 400;">    }</span>&#13; <span style="font-weight: 400;">&lt;/</span><span style="font-weight: 400;">style</span><span style="font-weight: 400;">&gt;</span></pre> <p><span style="font-weight: 400;">更新</span> <span style="font-weight: 400;"> <code>index.svelte</code> </span> <span style="font-weight: 400;">使用 AllQuestions </span></p> <pre><span style="font-weight: 400;">svelte/src/routes/index.svelte</span>&#13; &#13; <span style="font-weight: 400;">&lt;</span><span style="font-weight: 400;">script</span><span style="font-weight: 400;">&gt;</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">import</span> <span style="font-weight: 400;">WalletConnect</span> <span style="font-weight: 400;">from</span> <span style="font-weight: 400;">'$lib/WalletConnect.svelte'</span><span style="font-weight: 400;">;</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">import</span> <span style="font-weight: 400;">AddQuestion</span> <span style="font-weight: 400;">from</span> <span style="font-weight: 400;">'$lib/AddQuestion.svelte'</span><span style="font-weight: 400;">;</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">import</span> <span style="font-weight: 400;">contractAbi</span> <span style="font-weight: 400;">from</span> <span style="font-weight: 400;">'../contracts/QuizFactory.json'</span><span style="font-weight: 400;">;</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">// NEW</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">import</span> <span style="font-weight: 400;">AllQuestions</span> <span style="font-weight: 400;">from</span> <span style="font-weight: 400;">'$lib/AllQuestions.svelte'</span><span style="font-weight: 400;">;</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">const</span> <span style="font-weight: 400;">contractAddr</span> <span style="font-weight: 400;">=</span> <span style="font-weight: 400;">'0xe7608e790a0ac33014fdeaef9c8bf0c37bf443f0'</span><span style="font-weight: 400;">;</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">export</span> <span style="font-weight: 400;">let</span> <span style="font-weight: 400;">web3Props</span> <span style="font-weight: 400;">=</span><span style="font-weight: 400;"> {</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">provider</span><span style="font-weight: 400;">:</span> <span style="font-weight: 400;">null</span><span style="font-weight: 400;">,</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">signer</span><span style="font-weight: 400;">:</span> <span style="font-weight: 400;">null</span><span style="font-weight: 400;">,</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">account</span><span style="font-weight: 400;">:</span> <span style="font-weight: 400;">null</span><span style="font-weight: 400;">,</span>&#13; <span style="font-weight: 400;">        </span><span style="font-weight: 400;">chainId</span><span style="font-weight: 400;">:</span> <span style="font-weight: 400;">null</span>&#13; <span style="font-weight: 400;">    };</span>&#13; <span style="font-weight: 400;">&lt;/</span><span style="font-weight: 400;">script</span><span style="font-weight: 400;">&gt;</span>&#13; &#13; <span style="font-weight: 400;">&lt;</span><span style="font-weight: 400;">h1</span><span style="font-weight: 400;">&gt;My Quiz&lt;/</span><span style="font-weight: 400;">h1</span><span style="font-weight: 400;">&gt;</span>&#13; <span style="font-weight: 400;">{#if !web3Props.account}</span>&#13; <span style="font-weight: 400;">    &lt;</span><span style="font-weight: 400;">WalletConnect</span> <span style="font-weight: 400;">bind:web3Props</span><span style="font-weight: 400;"> {</span><span style="font-weight: 400;">contractAddr</span><span style="font-weight: 400;">} {</span><span style="font-weight: 400;">contractAbi</span><span style="font-weight: 400;">} /&gt;</span>&#13; <span style="font-weight: 400;">{:else}</span>&#13; <span style="font-weight: 400;">    &lt;</span><span style="font-weight: 400;">AddQuestion</span><span style="font-weight: 400;"> {</span><span style="font-weight: 400;">web3Props</span><span style="font-weight: 400;">} /&gt;</span>&#13; <span style="font-weight: 400;">    </span><span style="font-weight: 400;">&lt;!-- NEW --&gt;</span>&#13; <span style="font-weight: 400;">    &lt;</span><span style="font-weight: 400;">br</span><span style="font-weight: 400;"> /&gt;</span>&#13; <span style="font-weight: 400;">    &lt;</span><span style="font-weight: 400;">br</span><span style="font-weight: 400;"> /&gt;</span>&#13; <span style="font-weight: 400;">    &lt;</span><span style="font-weight: 400;">AllQuestions</span><span style="font-weight: 400;"> {</span><span style="font-weight: 400;">web3Props</span><span style="font-weight: 400;">} /&gt;</span>&#13; <span style="font-weight: 400;">{/if}</span></pre> <p>现在，您所有的测验问题都显示出来了！</p> <p><img decoding="async" loading="lazy" class="alignnone wp-image-3947 size-full" src="../Images/dd5f2469ee8e7435336ec20dedc0e1f3.png" alt="Quiz Answer" width="1600" height="600" srcset="https://blog.chain.link/wp-content/uploads/2022/06/unnamed-3.png 1600w, https://blog.chain.link/wp-content/uploads/2022/06/unnamed-3-300x113.png 300w, https://blog.chain.link/wp-content/uploads/2022/06/unnamed-3-1024x384.png 1024w, https://blog.chain.link/wp-content/uploads/2022/06/unnamed-3-768x288.png 768w, https://blog.chain.link/wp-content/uploads/2022/06/unnamed-3-1536x576.png 1536w, https://blog.chain.link/wp-content/uploads/2022/06/unnamed-3-24x9.png 24w, https://blog.chain.link/wp-content/uploads/2022/06/unnamed-3-36x14.png 36w, https://blog.chain.link/wp-content/uploads/2022/06/unnamed-3-48x18.png 48w" sizes="(max-width: 1600px) 100vw, 1600px" data-original-src="https://blog.chain.link/wp-content/uploads/2022/06/unnamed-3.png"/></p> <p>在这里，你可以添加更多的测验问题或资助现有的问题。一旦得到资助，你将能够回答他们。</p> <p><img decoding="async" loading="lazy" class="alignnone wp-image-3948 size-full" src="../Images/f6623d7ceaa631965d7834ec082c4f7a.png" alt="What is the answer?" width="1534" height="338" srcset="https://blog.chain.link/wp-content/uploads/2022/06/unnamed-4.png 1534w, https://blog.chain.link/wp-content/uploads/2022/06/unnamed-4-300x66.png 300w, https://blog.chain.link/wp-content/uploads/2022/06/unnamed-4-1024x226.png 1024w, https://blog.chain.link/wp-content/uploads/2022/06/unnamed-4-768x169.png 768w, https://blog.chain.link/wp-content/uploads/2022/06/unnamed-4-24x5.png 24w, https://blog.chain.link/wp-content/uploads/2022/06/unnamed-4-36x8.png 36w, https://blog.chain.link/wp-content/uploads/2022/06/unnamed-4-48x11.png 48w" sizes="(max-width: 1534px) 100vw, 1534px" data-original-src="https://blog.chain.link/wp-content/uploads/2022/06/unnamed-4.png"/></p> <h2>摘要</h2> <p>在本教程中，我们已经使用测试驱动开发创建了一组契约，允许我们存储区块链上测验问题的散列答案。这些答案以安全的方式存储，防止参与者作弊。我们还使用参与者的钱包将一个 SvelteKit 前端连接到区块链，并允许他们添加和回答问题。</p> <p>从这里你可以建立更完整的测验部分，或者在前端的显示上工作。一个巧妙的想法是使用<a href="https://chain.link/automation">chain link Automation</a><span style="font-weight: 400;">来限制回答问题的时间窗口，或者允许多个“赢家”在最后分享奖金。</span></p> <p><span style="font-weight: 400;">访问</span><a href="https://chain.link/"><span style="font-weight: 400;">chain . link</span></a><span style="font-weight: 400;">或阅读</span><a href="https://docs.chain.link/"><span style="font-weight: 400;">docs . chain . link</span></a><span style="font-weight: 400;">上的文档，了解更多关于 Chainlink 的信息。要讨论集成，<a href="https://chainlinkcommunity.typeform.com/to/OYQO67EF">联系专家。</a>T15】</span></p> <div class="widget_tag_cloud tag-list"/> </body> </html></iframe>